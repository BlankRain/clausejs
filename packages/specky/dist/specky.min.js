!function(n,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("S",[],e):"object"==typeof exports?exports.S=e():n.S=e()}(this,function(){return function(n){function e(t){if(r[t])return r[t].exports;var o=r[t]={i:t,l:!1,exports:{}};return n[t].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var r={};return e.m=n,e.c=r,e.i=function(n){return n},e.d=function(n,e,r){Object.defineProperty(n,e,{configurable:!1,enumerable:!0,get:r})},e.n=function(n){var r=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(r,"a",r),r},e.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},e.p="",e(e.s=58)}([function(n,e){function r(n,e,r,t){if(this.isProblem=!0,4!==arguments.length)throw"Problem arg len err";this.val=n,this.name="Problem",this.failsPredicate=e,this.problemMessage=t,this.message=t,this.subproblems=r}n.exports=r},function(n,e){function r(n,e,r,t,o){if(5!==arguments.length)throw new Error("Wrong number of arguments ("+arguments.length+") passed to Spec constructor");if(!Array.isArray(e))throw new Error("Expect an array of specs");this.type=n,r&&(this.opts=r),t&&(this.conform=t),o&&(this.generate=o),this.exprs=e}n.exports=r},function(n,e,r){function t(n){return n instanceof o}var o=r(0);n.exports=t},function(n,e){"use strict";function r(n){if(null===n||void 0===n)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(n)}function t(){try{if(!Object.assign)return!1;var n=new String("abc");if(n[5]="de","5"===Object.getOwnPropertyNames(n)[0])return!1;for(var e={},r=0;r<10;r++)e["_"+String.fromCharCode(r)]=r;var t=Object.getOwnPropertyNames(e).map(function(n){return e[n]});if("0123456789"!==t.join(""))return!1;var o={};return"abcdefghijklmnopqrst".split("").forEach(function(n){o[n]=n}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},o)).join("")}catch(n){return!1}}var o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;n.exports=t()?Object.assign:function(n,e){for(var t,u,a=r(n),f=1;f<arguments.length;f++){t=Object(arguments[f]);for(var s in t)o.call(t,s)&&(a[s]=t[s]);if(Object.getOwnPropertySymbols){u=Object.getOwnPropertySymbols(t);for(var c=0;c<u.length;c++)i.call(t,u[c])&&(a[u[c]]=t[u[c]])}}return a}},function(n,e,r){function t(n){return!!n&&n instanceof o}var o=r(1);n.exports=t},function(n,e,r){function t(n){if(a(n)||f(n)||s(n))return n;if(u(n))return o(n);throw new Error("Expression must either be a Spec object or a predication function that returns true or false. ")}function o(n){return new c(v,[n],null,i(n),null)}function i(n){return function(e){return n(e)?e:new l(e,n,[],"Predicate "+p(n)+" returns false on value "+JSON.stringify(e))}}var u=r(7),a=r(4),f=r(27),s=r(25),c=r(1),l=r(0),p=r(13),v="PRED";n.exports=t},function(n,e){function r(n){return null!==n&&void 0!==n&&n.constructor===String}n.exports=r},function(n,e,r){function t(n){return o(n)}var o=r(12);r(1);n.exports=t},function(n,e,r){function t(n,e,r){var t=r.phase,u=(r.conform,r.instrument,o(n));if(t){if(u[t])return u[t](e,r);throw"!"}var a=u.trailblaze(e,i({phase:"trailblaze"},r));return m(a)?a:u.reconstruct(a,i({phase:"reconstruct"},r))}function o(n){var e,r=d(n);if(["OR","CAT","Z_OR_M","O_OR_M","Z_OR_O"].indexOf(r.type)>=0)e=u;else if(["COLL_OF"].indexOf(r.type)>=0)e=l;else if("PRED"===r.type)e=a;else if("PROPS"===r.type)e=s;else if("AND"===r.type)e=c;else if("SpecRef"===r.type)e=p;else if("Delayed"===r.type)e=v;else{if("FSPEC"!==r.type)throw"unsupported type "+r.type;e=f}var o=e(r,t);return o}var i=r(3),u=r(52),a=r(53),f=r(51),s=r(54),c=r(48),l=r(49),p=r(55),v=r(50),d=r(5),m=r(2);n.exports=t},function(n,e,r){function t(n){var e=new o("FSPEC",[],n,null,null);return e.instrumentConformed=function(n){return i(e,n,{conform:!0,instrument:!0})},e.instrument=function(n){return i(e,n,{conform:!1,instrument:!0})},e}var o=r(1),i=r(8);n.exports=t},function(n,e){n.exports=function(n){return void 0===n}},function(n,e,r){function t(n){return v(n,function(e){var r;if(e.named){r=e.named;var t=r.map(function(n){var e=n.expr,r=s(e);return i({},n,{expr:r,spec:void 0,pred:void 0,specRef:void 0,delayedSpec:void 0})}),o=new u(n,t,null,null,null);return o.conform=function(n){return x(o,n,{conform:!0})},o}if(e.unnamed){r=e.unnamed;var t=r.map(function(n){if(n.spec){var e=n.spec;return i({},n,{expr:e,spec:void 0})}if(n.pred){var e=y(n.pred);return i({},n,{expr:e,pred:void 0})}if(n.specRef){var e=n.specRef;return i({},n,{expr:e,specRef:void 0})}if(n.delayedSpec){var e=n.delayedSpec;return i({},n,{expr:e,delayedSpec:void 0})}throw console.error(n),"Not implemented"}),o=new u(n,t,null,null,null);return o.conform=function(n){return x(o,n,{conform:!0})},o}})}function o(n){return v(n,function(e){var r,t=e.expr,o=e.opts;if(t.spec)r=t.spec;else if(t.pred)r=y(t.pred);else if(t.specRef)r=t.specRef;else{if(!t.delayedSpec)throw"internal err";r=t.delayedSpec}var i=new u(n,[y(r)],o,null,null);return i.conform=function(n){return x(i,n,{conform:!0})},i})}var i=r(3),u=r(1),a=r(4),f=r(7),s=r(29),c=r(21),l=r(6),p=r(46),v=r(28),d=r(27),m=r(25),h=r(34),y=r(5),g=r(9),x=r(8),O=y(a),b=y(p),w=t(h.CAT),_=t(h.OR),S=o(h.Z_OR_M),R=o(h.O_OR_M),A=o(h.Z_OR_O),E=o(h.COLL_OF),k=_({named:[{name:"specRef",expr:{spec:d}},{name:"pred",expr:{pred:f}},{name:"delayedSpec",expr:{spec:m}},{name:"spec",expr:{pred:a}}]}),P=w({named:[{name:"name",expr:{spec:b}},{name:"expr",expr:{spec:k}}]}),j=w({named:[{name:"name",expr:{spec:b}},{name:"comment",expr:{spec:l}},{name:"expr",expr:{spec:k}}]}),C=_({unnamed:[{spec:P},{spec:j}]}),M=_({named:[{name:"named",expr:{spec:_({unnamed:[{spec:S({expr:{spec:C}})},{spec:E({expr:{spec:C}})}]})}},{name:"unnamed",expr:{spec:S({expr:{spec:k}})}}]}),F={args:M,ret:O},z={args:w({named:[{name:"expr",expr:{spec:k}},{name:"opts",expr:{spec:A({expr:{pred:c}})}}]}),ret:O},D=g(z).instrumentConformed(E),N={cat:g(F).instrumentConformed(w),or:g(F).instrumentConformed(_),zeroOrMore:g(z).instrumentConformed(S),zeroOrOne:g(z).instrumentConformed(A),oneOrMore:g(z).instrumentConformed(R),ExprSpec:k,collOf:D,arrayOf:D};N.alt=N.or,N["*"]=N.zeroOrMore,N["+"]=N.oneOrMore,N["?"]=N.zeroOrOne,n.exports=N;_({named:[{name:"named",expr:{spec:_({unnamed:[{spec:S({expr:{spec:C}})},{spec:E({expr:{spec:C}})}]})}},{name:"unnamed",expr:{spec:S({expr:{spec:k}})}}]})},function(n,e){function r(n){var e={};return(n||!1)&&"[object Function]"===e.toString.call(n)}n.exports=r},function(n,e){function r(n){var e=n.toString();return e=e.substr("function ".length),e=e.substr(0,e.indexOf("("))}n.exports=r},function(n,e,r){var t=r(3),o=r(11),i=r(16),u=i.props,a=i.keys,f={and:r(32),any:r(33),fspec:r(9)},s=t({},o,{props:u,keys:a},f);n.exports=s},function(n,e,r){var t=r(20),o=r(41),i=r(19),u=r(40),a=r(12),f=r(21),s=r(39),c=r(6),l=Array.isArray;n.exports={isNull:r(42),isUndefined:r(10),notEmpty:r(43),isBool:u,isBoolean:u,isFn:a,isFunction:a,isNum:t,isNumber:t,isNatInt:o,isNaturalNumber:o,isInt:i,isInteger:i,isObj:f,isObject:f,isStr:c,isString:c,isArray:l,equals:s}},function(n,e,r){function t(n){return a(n)}function o(n){var e=new i(y,[n],null,null,null);return e.conform=function(n){return m(e,n,{conform:!0})},e}var i=r(1),u=r(4),a=r(6),f=(r(12),r(44)),s=r(5),c=r(11),l=c.cat,p=c.or,v=c.zeroOrMore,d=c.ExprSpec,m=r(8),h=r(9),y="PROPS",g=o({propArgs:{optionalFields:{opt:{fieldDefs:{fields:{fields:{keyValExprPair:{keySpecAlts:{spec:s(a)},valSpecAlts:{spec:p("valSpecAltsOnly",d,"keyValExprPair",l("keySpecAlts",d,"valSpecAlts",d))}}}}}}}}}),x=v(t),O=p("keyList",x,"fieldDefs",g),b=o({propArgs:{optionalFields:{opt:{fieldDefs:{fields:{requiredFields:{keyValExprPair:{keySpecAlts:{pred:f("req","required")},valSpecAlts:{spec:O}}},optionalFields:{keyValExprPair:{keySpecAlts:{pred:f("opt","optional")},valSpecAlts:{spec:O}}}}}}}}}),w=h({args:l("propArgs",b),ret:u}),_=w.instrumentConformed(o);n.exports={props:_,keys:_}},function(n,e){function r(n){var e=n.getFn;this.type="Delayed",this.get=e;var r=this;["conform","instrument"].forEach(function(n){r[n]=function(r){var t=e();return t[n].call(this,r)}})}n.exports=r},function(n,e){function r(n){var e=n.ref,r=n.getFn,t=n.conformFn;this.type="SpecRef",this.get=r,this.conform=t,this.ref=e}n.exports=r},function(n,e){function r(n){return"number"==typeof n&&(Math.floor(n)===n&&n!==1/0)}n.exports=r},function(n,e){function r(n){return"number"==typeof n}n.exports=r},function(n,e){function r(n){return"object"===("undefined"==typeof n?"undefined":t(n))&&null!==n}var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n};n.exports=r},function(n,e,r){function t(n,e){if(n&&o(n)){var r=n.conform(e);return r}throw new Error("Expression needs to be of type Spec. expression: "+n+", offending value: "+e)}var o=r(4);n.exports=t},function(n,e,r){function t(n){return new o({getFn:n})}var o=r(17);n.exports=t},function(n,e){function r(n){return n}n.exports=r},function(n,e,r){var t=r(17);n.exports=function(n){return n instanceof t}},function(n,e,r){function t(n){return o(n)||i(n)}var o=r(7),i=r(4);n.exports=t},function(n,e,r){var t=r(18);n.exports=function(n){return n instanceof t}},function(n,e){function r(n,e,r){return n?new Function("action","return function "+n+(r||"")+"(){ return action.apply(this, arguments); };")(e):e}n.exports=r},function(n,e,r){var t=r(5);n.exports=function(n){if(n.spec)return n.spec;if(n.pred)return t(n.pred);if(n.specRef)return n.specRef;if(n.delayedSpec)return n.delayedSpec;throw console.error(p),"Not implemented"}},function(n,e,r){(function(e){function t(n){return _(n)}function o(n){var e=function(e){var r=c;r=e?e+n:n;var t=l.get(c,r);return t?t.expr:void 0},r=new v({ref:n,getFn:e,null:null});return r.conform=function(n){return A(ss,n,{conform:!0})},r}function i(n){var e;if(n.def){var r=n.def.name,t=n.def.val;e=u(r,t)}else if(n.get){var r=n.get.name,o=k(r);e=o}return e}function u(n,e){if(e.expr){var r=e.expr;if(r.spec||r.pred){var t=r.spec||r.pred;return M(n,{expr:t}),t}throw console.error(r),"internal erro"}if(!e.partialRefMap)throw console.error(e),"no impl";var o=e.partialRefMap.refDefs;for(var i in o)if(o.hasOwnProperty(i)){u(o[i])}}function a(n){return n instanceof v}function f(){return c||s(),c}function s(){c=e[F]={}}var c,l=r(56),p=r(3),v=r(18),d=r(14),m=d.cat,h=d.or,y=d.fspec,g=d.ExprSpec,x=r(16),O=x.props,b=r(4),w=r(7),_=r(6),S=r(26),R=r(10),A=r(8),E=r(23),k=y({args:m(t),ret:a}).instrument(o),P=h("expr",E(function(){return g})),j=y({args:h("def",m("name",t,"val",P),"get",m("name",t)),ret:h(a,S)}),C=O({req:{expr:h(b,w)}}),M=y({args:m(t,C),ret:R}).instrument(function(n,e){f();var r=l.get(c,n);l.set(c,n,p({},r,e))}),F="___SPECKY_REGISTRY";f();var z=j.instrumentConformed(i);z.clearRegistry=s,n.exports=z}).call(e,r(57))},function(n,e,r){n.exports={conform:r(22),isValid:r(47),identity:r(24),isProblem:r(2),delayed:r(23)}},function(n,e,r){function t(n){var e=n.exprs,r=new f("AND",e,null,null,null);return r.conform=function(n){return d(r,n,{conform:!0})},r}var o=r(15),i=(o.isBool,o.isFn),u=r(26),a=r(4),f=(r(2),r(1)),s=(r(0),r(11)),c=s.oneOrMore,l=s.zeroOrOne,p=(s.or,s.cat),v=r(9),d=r(8),m=v({args:p("exprs",c(u),"walker",l(i)),ret:a});n.exports=m.instrumentConformed(t)},function(n,e,r){function t(){return new o(u,[],null,i,null)}var o=r(1),i=r(24),u="ANY";n.exports=t},function(n,e){n.exports={CAT:"CAT",OR:"OR",Z_OR_M:"Z_OR_M",Z_OR_O:"Z_OR_O",O_OR_M:"O_OR_M",PRED:"PRED",COLL_OF:"COLL_OF"}},function(n,e,r){function t(n){var e;if(null===n.type)throw"Spec has no type: "+n;e=n.type in f?f[n.type]:f.PRED;var r=e(n);return r}function o(n){return new u("ROOT",[n],null,null,null)}var i=r(36),u=r(1),a=function(n){for(var e=0,r=[n.head],t=[];r.length>0;){var o=r.pop();null===o.index&&(o.index=e,e++,o.transitions.forEach(function(n){r.push(n.target)}),t.push(o))}return t},f={},s=function(n){return function(e){var r=t(e.exprs[0]);return n(r)}},c=function(n){return function(e){var r=e.exprs.map(function(n){var e=t(n.expr);return e.name=n.name,e});return n(r)}};["ROOT","Z_OR_M","O_OR_M","Z_OR_O"].forEach(function(n){f[n]=s(i[n])}),["OR","CAT"].forEach(function(n){f[n]=c(i[n])}),f.PRED=function(n){return i.PRED(n)};var l=function(n){var e,r=o(n),i=t(r),u=a(i),f=u.length,s={};return u.forEach(function(n){0===n.transitions.length&&(e=n.index);var r={};n.transitions.forEach(function(n){r[n.target.index]=n.spec}),s[n.index.toString()]=r}),{initialState:0,numStates:f,finalState:e,transitions:s,expression:n}};n.exports=l},function(n,e){function r(n,e){n.forEach(function(n){n.target=e})}function t(){return{isEpsilon:!0}}function o(n,e,r,o){var i=t();return i.name=e,i.op=r,i.group=o,i.dir=n,i}function i(n,e){var r=f(n,e.head),t=a([r]),o=s(t,e.tails);return o}function u(n,e){var t=f(n,null),o=a([t],null);r(e.tails,o);var i=s(e.head,[t]);return i}var a=function(n,e){return{transitions:null===n?[]:n,index:e||null}},f=function(n,e){return{spec:n,target:e}},s=function(n,e){return{head:n,tails:e}},c=function(n,e,r){var t=s(e,r);return t.name=n,t},l={};l.PRED=function(n){var e=f(n,null),r=a([e],null),t=[e],o=s(r,t);return o},l.CAT=function(n){var e=function(n,e){r(n.tails,e.head);var t=n.head,o=e.tails,i=s(t,o);return i};n=n.map(function(n){var e=f(o("out",n.name,"CAT"),null),t=a([e]);r(n.tails,t);var i=n.head.transitions.map(function(e){var r=a([e]),t=f(o("in",n.name,"CAT"),r);return t}),u=a(i),s=c(n.name,u,[e]);return s});var l;if(n.length>0)l=n.reduce(e);else{var p=t(),v=f(p,null),d=a([v]);l=s(d,[v])}return l=i(o("multi_enter",null,"CAT","in"),l),l=u(o("multi_exit",null,"CAT","out"),l)},l.OR=function(n){n=n.map(function(n){var e=o("out",n.name,"OR"),t=f(e,null),i=a([t]);r(n.tails,i);var u=f(o("in",n.name,"OR"),n.head),s=a([u]),l=c(n.name,s,[t]);return l});var e=function(n,e){var r=n.head.transitions.concat(e.head.transitions),t=a(r),o=n.tails.concat(e.tails),i=c(n.name,t,o);return i},t=n.reduce(e);return t=i(o("enter",null,"OR"),t),t=u(o("exit",null,"OR"),t)},l.Z_OR_M=function(n){var e="Z_OR_M",c=f(o("loop",null,e),n.head),l=f(t(),null),p=a([c,l]);r(n.tails,p);var v=s(p,[l]),d=v.head.transitions.map(function(n){var e=a([n]),r=f(t(),e);return r}),m=a(d);return v=s(m,v.tails),v=i(o("maybe_enter",null,e,"in"),v),v=u(o("maybe_exit",null,e,"out"),v)},l.O_OR_M=function(n){var e="O_OR_M",c=f(o("loop",null,e),n.head),l=f(t(),null),p=a([c,l]);r(n.tails,p);var v=s(n.head,[l]);return v=i(o("maybe_enter",null,e,"in"),v),v=u(o("maybe_exit",null,e,"out"),v)},l.Z_OR_O=function(n){var e="Z_OR_O",r=f(o("loop",null,e),n.head),c=f(t(),null),l=a([r,c]),p=n.tails.concat([c]),v=s(l,p);return v=i(o("maybe_single_enter",null,e),v),v=u(o("maybe_single_exit",null,e),v)},l.ROOT=function(n){var e=a(null,null);return r(n.tails,e),s(n.head,[])},n.exports=l},function(n,e,r){function t(n,e,r){var t=r.conform;!n||!n.forEach;var d=[],m={};if(n.forEach(function(n){if(n.move)switch(n.move.dir){case"enter":d.push(f);break;case"multi_enter":d.push(s);break;case"maybe_enter":d.push(c);break;case"maybe_single_enter":d.push(l);break;case"in":d.push(new p(n.move.name));break;case"loop":null!==d[d.length-1]&&d.push(a);break;case"pred":var m=e(n.spec,n.guide,r);d.push(m);break;case"out":var h=d.pop();if(!(h instanceof p)){var y,g=d.pop().value;null!==g&&void 0!==g&&t?(y={},u(h)||(y[g]=h)):y=new v(h),d.push(y)}break;case"maybe_single_exit":for(var x=d.pop(),O=null;x!==l;)x!==a&&(O=x),x=d.pop();null===O&&(O=void 0),d.push(O);break;case"maybe_exit":for(var x=d.pop(),O=null;x!==c;)x!==a&&(O=o(O,x)),x=d.pop();null===O&&(O=[]),d.push(O);break;case"multi_exit":for(var x=d.pop(),O=null;x!==s;)O=x instanceof v?null===O?[x.value]:[x.value].concat(O):i({},x,O),x=d.pop();null===O&&(O=[]),d.push(O);break;case"exit":for(var x=d.pop(),O=null;x!==f;)O=x instanceof v?null===O?x.value:[x.value].concat(O):i({},x,O),x=d.pop();null===O&&(O=[]),d.push(O);break;default:throw console.error(n),"FUUU"}}),1!==d.length)throw console.error("valStack",d),"!valStack.length";var m=d.pop();return m}function o(n,e){var r;return r=null===n?[e]:Array.isArray(n)?[e].concat(n):[e,n]}var i=r(3),u=(r(0),r(10)),a=function(){},f=function(){},s=function(){},c=function(){},l=function(){},p=function(n){this.value=n},v=function(n){this.value=n};n.exports=t},function(n,e,r){function t(n,e,r,t){for(var u,a={matched:!1,chain:null},f={state:0,offset:0,leftOff:0,input:[e],groupCount:0,arrayed:!1},s=[f];s.length>0;){var c=s.shift(),l=c.offset,p=c.leftOff,u=c.input,v=c.groupCount,d=c.arrayed;if(c.state===n.finalState&&l===u.length)return a.matched=!0,a.chain=o(n,c,r,t),a;for(var m in n.transitions[c.state]){var h=parseInt(m),y=u[l],g=n.transitions[c.state][h];"in"===g.group?(0===v&&Array.isArray(u[0])&&(u=u[0],l=0,d=!0),v+=1):"out"===g.group&&(v-=1,0===v&&(d&&(l=l===u.length?1:0,u=[u]),d=!1));var x,O;x=g.isEpsilon?l:l+1;var b,w;x<=u.length&&(g.isEpsilon?(O=g.dir?{dir:g.dir,name:g.name,op:g.op,group:g.group}:null,w={input:u,groupCount:v,arrayed:d,leftOff:p,state:h,offset:x,move:O,spec:g,prev:c,isEpsilon:!0},s.push(w)):(b=r(g,y,t),i(b)?a.lastProblem=b:l<u.length&&(O={dir:"pred"},w={input:u,groupCount:v,arrayed:d,leftOff:p,state:h,offset:x,move:O,prev:c,isEpsilon:!1,spec:g,guide:b},s.push(w))))}}return a}function o(n,e,r,t){for(var o,i=[],u=e;u;){if(!o||u.state!==o.state&&u.move){var a={isEpsilon:u.isEpsilon,move:u.move,state:u.state};u.isEpsilon||(a.guide=u.guide,a.spec=u.spec),i.unshift(a)}o=u,u=u.prev}return i}var i=r(2);n.exports=t},function(n,e){n.exports=function(n){return function(e){return e===n}}},function(n,e){function r(n){return"boolean"==typeof n}n.exports=r},function(n,e,r){function t(n){return o(n)&&n>=0}var o=r(19);n.exports=t},function(n,e){function r(n){return null===n}n.exports=r},function(n,e){n.exports=function(n){return!!n&&0!==n.length}},function(n,e){n.exports=function(n){var n;if(1===arguments.length&&Array.isArray(arguments[0]))n=arguments[0];else{if(!(arguments.length>0))throw new Error("Items list is required.");n=Array.from(arguments)}return function(e){return n.indexOf(e)>=0}}},function(n,e){function r(n){throw n}n.exports=r},function(n,e,r){var t=r(6);n.exports=function(n){return t(n)}},function(n,e,r){function t(n,e){if(n)return u(n)?!o(a(n,e)):!i(n)||n(e);throw new Error("Spec is required")}var o=(r(0),r(2)),i=r(7),u=r(4),a=r(22);n.exports=t},function(n,e,r){function t(n,e){function r(n,r){for(var t=(r.trailblaze,n),a=[],f=0;f<u.length;f+=1)if(t=e(u[f],n,r),i(t)){a.push(t);break}return a&&0!==a.length?new o(n,u,a,"One or more expressions failed AND test"):t}function t(n,r){for(var t=n,o=0;o<u.length;o+=1)t=e(u[o],t,r);return t}var u=n.exprs;return{trailblaze:r,reconstruct:t}}var o=r(0),i=r(2);n.exports=t},function(n,e,r){function t(n,e){function r(r,t){if(Array.isArray(r)){if(f){var s=f.maxCount,c=f.minCount;if(u(s)&&r.length>s)return new o(r,n,p,"collOf: collection size "+r.length+" exceeds maxCount "+s+".");if(u(c)&&r.length<c)return new o(r,n,p,"collOf: collection size "+r.length+" is less than minCount "+c+".")}for(var l=[],p=[],v=0;v<r.length;v+=1){var d=e(a,r[v],t);if(i(d)){p.push(d);break}l.push(d)}return p.length>0?new o(r,n,p,"One or more elements failed collOf test"):l}return new o(r,n,[],"collOf expects an array")}function t(n,r){for(var t=[],o=0;o<n.length;o+=1){var i=e(a,n[o],r);t.push(i)}return t}var a=n.exprs[0],f=n.opts;return{trailblaze:r,reconstruct:t}}var o=(r(5),r(0)),i=r(2),u=r(20);n.exports=t},function(n,e){function r(n,e){function r(r,t){var o=n.get();if(o)return e(o,r,t)}return{trailblaze:r,reconstruct:r}}n.exports=r},function(n,e,r){function t(n,e){function r(n){return n}function t(e,r){if(!e)return new i(e,n,[],"function is not specified");var t=r.conform,o=r.instrument;return t&&o?c(e,r):o?s(e,r):void 0}function s(n,e){var r=u(n),t=l(r,n,e),o=a(r,t,"__instrumented");return o}function c(n,e){var r=u(n),t=m(r,n,e),o=a(r,t,"__conformed");return o}function l(n,r){return function(){var t=Array.from(arguments),o=v(r,n,t),i=r.apply(this,o),u=d(r,n,i),a=e(y,t,{conform:!0,instrument:!0}),f=e(g,i,{conform:!0,instrument:!0});return p(n,r,x,a,f),u}}function p(e,r,t,o,u){if(t){var a=t.call(null,o,u);if(!a){var s=new i(r,n,[],"Function "+e+" failed valiation on argument-return value relation");f(s)}}}function v(r,t,u){if(!y)return u;var a=e(y,u,{phase:"trailblaze"});if(!o(a))return e(y,a,{phase:"reconstruct",conform:!1,instrument:!0});var s=new i(u,n,[a],"Arguments "+JSON.stringify(u)+" for function "+t+" failed validation");f(s)}function d(r,t,u){if(!g)return u;var a=e(g,u,{phase:"trailblaze"});if(!o(a)){var s=e(g,a,{phase:"reconstruct",instrument:!0,conform:!1});return s}var c=new i(u,n,[a],"Return value "+u+" for function "+t+" is not valid.");f(c)}function m(n,r){return function(){var t=Array.from(arguments),u=e(y,t,{conform:!0,instrument:!0});if(o(u)){var a=new i(t,y,[u],"Arguments "+JSON.stringify(t)+" for function "+n+" is not valid");f(a)}var s=r.call(this,u),c=e(g,s,{conform:!0,instrument:!0});return d(r,n,s),p(n,r,x,u,c),s}}var h=n.opts,y=h.args,g=h.ret,x=h.fn;return{trailblaze:r,reconstruct:t}}var o=r(2),i=r(0),u=r(13),a=r(28),f=r(45);r(3);n.exports=t},function(n,e,r){function t(n,e){function r(r,t){f||(f=u(n));var i=o(f,r,e,t),s=i.chain,c=i.matched,l=i.lastProblem;if(c===!0)return s;var p=[];return l&&p.push(l),new a(r,n,p,"Spec "+n.type+" did not match val: "+JSON.stringify(r))}function t(n,r){var t=i(n,e,r);return t}var f;return{trailblaze:r,reconstruct:t}}var o=r(38),i=r(37),u=r(35),a=r(0);r(2);n.exports=t},function(n,e,r){function t(n,e){function r(e,r){var t=(r.conform,r.instrument,r.trailblaze,n.exprs[0]);return t(e)?e:new i(e,n,[],"Predicate "+o(t)+" returns false on value "+JSON.stringify(e))}function t(n,e){return n}return{trailblaze:r,reconstruct:t}}var o=r(13),i=r(0);n.exports=t},function(n,e,r){function t(n,e){function r(r,t){function o(n){n:for(var o in n.fields)if(n.fields.hasOwnProperty(o)){var i=n.fields[o],u=a(r,o,i,e,t),f=u.noop,s=u.problem,c=u.singleMatch,l=u.groupMatch;if(s){m.push([o,s]);break n}if(c)h.singles.push(c);else if(l)l.matchedKeys.length>0&&h.groups.push(l);else if(!f)throw"!"}}f||(f=i(c,v,e,t));var u=f(r);if(s(u))return u;var l,d,m=[],h={val:r,groups:[],singles:[]};c&&(l=c.fieldDefs,d=c.keyList),l&&o(l);var y,g;if(v&&(y=v.fieldDefs,g=v.keyList),y&&o(y),m.length>0){for(var x={},O=[],b=0;b<m.length;b++){var w=m[b],_=w[0],S=w[1];O.push(_),x[_]=S}var R=new p(r,n,x,"At least one property failed validation: "+O.join(", "));return R}return h}function t(n,r){var t,i,a=n.val,f=n.singles,s=n.groups,p={walkOpts:r},v=r.instrument;c&&(t=c.fieldDefs,i=c.keyList);var d;return d=v?a:l({},a),f.forEach(function(n){o(d,n,e,r)}),s.forEach(function(n){var t=n.name,i=n.matchedKeys;if(p){d[t]={};var a=[];i.forEach(function(n){o(d[t],n,e,r),a.push(n.key)}),u(d,a)}else i.forEach(function(n){o(d,n,e,r)})}),d}var f,c,v,d=n.exprs[0].propArgs,m=d.requiredFields,h=d.optionalFields;return m&&(c=m.req||m.required),h&&(v=h.opt||h.optional),{trailblaze:r,reconstruct:t}}function o(n,e,r,t){var o=e.key,i=e.spec,u=e.guide;n[o]=r(i,u,t)}function i(n,e,r,t){return function(e){if(n){var o,i=[],u=[],a=n.fieldDefs,c=n.keyList;if(a){o=[];for(var l in a.fields)a.fields.hasOwnProperty(l)&&o.push(l)}else{if(!c)throw"unsupported";o=[].concat(c)}for(var v=0;v<o.length;v++){var l=o[v];if(a&&a.fields[l].keyValExprPair){var d=!1;n:for(var m in e)if(e.hasOwnProperty(m)){var h=f(m,a.fields[l].keyValExprPair.keySpecAlts,r,t);if(!s(h)){d=!0;break n}}d||u.push(l)}else if(a&&a.fields[l].valSpecAltsOnly)if(e.hasOwnProperty(l)){var h=f(e[l],a.fields[l].valSpecAltsOnly,r,t);s(h)&&(i.push(h),u.push(l))}else u.push(l);else c&&void 0===e[l]&&u.push(l)}if(u.length>0)return new p(e,n,i,"req: keys required: "+u.join(", "));if(i.length>0)return new p(e,n,i,"req: validation failed for the following keys: "+u.join(", "))}return e}}function u(n,e){for(var r=0;r<e.length;r++)delete n[[e[r]]]}function a(n,e,r,t,o){var i,u=r.valSpecAltsOnly,a=r.keyValExprPair;if(a){var l=[],p=a.keySpecAlts,d=a.valSpecAlts;i=void 0;n:for(var m in n){var h=f(m,p,t,o);if(!s(h)){if(n===n[m])continue n;var y=f(n[m],d,t,o);if(s(y))return{problem:y};l.push({key:m,spec:v(d),guide:y})}}return{groupMatch:{name:e,matchedKeys:l}}}if(u){var g=n[e];if(c(g)||n[e]===n)return{noop:!0};var x=f(g,u,t,o);return s(x)?{problem:x}:{singleMatch:{key:e,spec:v(u),guide:x}}}throw"!!"}function f(n,e,r,t){var o=v(e),i=r(o,n,t);return i}var s=r(2),c=r(10),l=r(3),p=r(0),v=(r(5),r(29));n.exports=t},function(n,e){function r(n,e){function r(r,t){var o=n.get();if(o)return e(ss,r,t)}return{trailblaze:r,reconstruct:r}}n.exports=r},function(n,e,r){var t,o,i;!function(r,u){"use strict";"object"==typeof n&&"object"==typeof n.exports?n.exports=u():(o=[],t=u,i="function"==typeof t?t.apply(e,o):t,!(void 0!==i&&(n.exports=i)))}(this,function(){"use strict";function n(n,e){return null!=n&&Object.prototype.hasOwnProperty.call(n,e)}function e(e){if(!e)return!0;if(f(e)&&0===e.length)return!0;if("string"!=typeof e){for(var r in e)if(n(e,r))return!1;return!0}return!1}function r(n){return a.call(n)}function t(n){return"object"==typeof n&&"[object Object]"===r(n)}function o(n){return"boolean"==typeof n||"[object Boolean]"===r(n)}function i(n){var e=parseInt(n);return e.toString()===n?e:n}function u(r){function u(e,t){if(r.includeInheritedProps||"number"==typeof t&&Array.isArray(e)||n(e,t))return e[t]}function a(n,e,r,t){if("number"==typeof e&&(e=[e]),!e||0===e.length)return n;if("string"==typeof e)return a(n,e.split(".").map(i),r,t);var o=e[0],f=u(n,o);return 1===e.length?(void 0!==f&&t||(n[o]=r),f):(void 0===f&&("number"==typeof e[1]?n[o]=[]:n[o]={}),a(n[o],e.slice(1),r,t))}r=r||{};var s=function(n){return Object.keys(s).reduce(function(e,r){return"create"===r?e:("function"==typeof s[r]&&(e[r]=s[r].bind(s,n)),e)},{})};return s.has=function(e,t){if("number"==typeof t?t=[t]:"string"==typeof t&&(t=t.split(".")),!t||0===t.length)return!!e;for(var o=0;o<t.length;o++){var u=i(t[o]);if(!("number"==typeof u&&f(e)&&u<e.length||(r.includeInheritedProps?u in Object(e):n(e,u))))return!1;e=e[u]}return!0},s.ensureExists=function(n,e,r){return a(n,e,r,!0)},s.set=function(n,e,r,t){return a(n,e,r,t)},s.insert=function(n,e,r,t){var o=s.get(n,e);t=~~t,f(o)||(o=[],s.set(n,e,o)),o.splice(t,0,r)},s.empty=function(r,i){if(!e(i)&&null!=r){var u,a;if(u=s.get(r,i)){if("string"==typeof u)return s.set(r,i,"");if(o(u))return s.set(r,i,!1);if("number"==typeof u)return s.set(r,i,0);if(f(u))u.length=0;else{if(!t(u))return s.set(r,i,null);for(a in u)n(u,a)&&delete u[a]}}}},s.push=function(n,e){var r=s.get(n,e);f(r)||(r=[],s.set(n,e,r)),r.push.apply(r,Array.prototype.slice.call(arguments,2))},s.coalesce=function(n,e,r){for(var t,o=0,i=e.length;o<i;o++)if(void 0!==(t=s.get(n,e[o])))return t;return r},s.get=function(n,e,r){if("number"==typeof e&&(e=[e]),!e||0===e.length)return n;if(null==n)return r;if("string"==typeof e)return s.get(n,e.split("."),r);var t=i(e[0]),o=u(n,t);return void 0===o?r:1===e.length?o:s.get(n[t],e.slice(1),r)},s.del=function(n,r){if("number"==typeof r&&(r=[r]),null==n)return n;if(e(r))return n;if("string"==typeof r)return s.del(n,r.split("."));var t=i(r[0]),o=u(n,t);if(null==o)return o;if(1===r.length)f(n)?n.splice(t,1):delete n[t];else if(void 0!==n[t])return s.del(n[t],r.slice(1));return n},s}var a=Object.prototype.toString,f=Array.isArray||function(n){return"[object Array]"===a.call(n)},s=u();return s.create=u,s.withInheritedProps=u({includeInheritedProps:!0}),s})},function(n,e){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(n){"object"==typeof window&&(r=window)}n.exports=r},function(n,e,r){var t=r(3),o=r(30),i=r(14),u=r(31),a=r(15),f={Problem:r(0),Spec:r(1)},s=t(o,i,u,f,a);n.exports=s}])});