!function(n,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define("S",[],r):"object"==typeof exports?exports.S=r():n.S=r()}(this,function(){return function(n){function r(t){if(e[t])return e[t].exports;var o=e[t]={i:t,l:!1,exports:{}};return n[t].call(o.exports,o,o.exports,r),o.l=!0,o.exports}var e={};return r.m=n,r.c=e,r.i=function(n){return n},r.d=function(n,r,e){Object.defineProperty(n,r,{configurable:!1,enumerable:!0,get:e})},r.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return r.d(e,"a",e),e},r.o=function(n,r){return Object.prototype.hasOwnProperty.call(n,r)},r.p="",r(r.s=55)}([function(n,r){function e(n,r,e,t){if(this.isProblem=!0,4!==arguments.length)throw"Problem arg len err";this.val=n,this.name="Problem",this.failsPredicate=r,this.problemMessage=t,this.stack=(new Error).stack,this.message=t,this.subproblems=e}e.prototype=new Error,n.exports=e},function(n,r){function e(n,r,e,t,o){if(5!==arguments.length)throw new Error("Wrong number of arguments ("+arguments.length+") passed to Spec constructor");if(!Array.isArray(r))throw new Error("Expect an array of specs");this.type=n,e&&(this.opts=e),t&&(this.conform=t),o&&(this.generate=o),this.exprs=r}n.exports=e},function(n,r,e){function t(n){return n instanceof o}var o=e(0);n.exports=t},function(n,r,e){function t(n){return!!n&&n instanceof o}var o=e(1);n.exports=t},function(n,r){"use strict";function e(n){if(null===n||void 0===n)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(n)}function t(){try{if(!Object.assign)return!1;var n=new String("abc");if(n[5]="de","5"===Object.getOwnPropertyNames(n)[0])return!1;for(var r={},e=0;e<10;e++)r["_"+String.fromCharCode(e)]=e;var t=Object.getOwnPropertyNames(r).map(function(n){return r[n]});if("0123456789"!==t.join(""))return!1;var o={};return"abcdefghijklmnopqrst".split("").forEach(function(n){o[n]=n}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},o)).join("")}catch(n){return!1}}var o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;n.exports=t()?Object.assign:function(n,r){for(var t,u,a=e(n),f=1;f<arguments.length;f++){t=Object(arguments[f]);for(var s in t)o.call(t,s)&&(a[s]=t[s]);if(Object.getOwnPropertySymbols){u=Object.getOwnPropertySymbols(t);for(var c=0;c<u.length;c++)i.call(t,u[c])&&(a[u[c]]=t[u[c]])}}return a}},function(n,r){function e(n){return null!==n&&void 0!==n&&n.constructor===String}n.exports=e},function(n,r,e){function t(n){if(a(n)||f(n)||s(n))return n;if(u(n))return o(n);throw new Error("Expression must either be a Spec object or a predication function that returns true or false. ")}function o(n){return new c(v,[n],null,i(n),null)}function i(n){return function(r){return n(r)?r:new l(r,n,[],"Predicate "+p(n)+" returns false on value "+JSON.stringify(r))}}var u=e(7),a=e(3),f=e(27),s=e(25),c=e(1),l=e(0),p=e(13),v="PRED";n.exports=t},function(n,r,e){function t(n){return o(n)}var o=e(12);e(1);n.exports=t},function(n,r,e){function t(n){var r=new o("FSPEC",[],n,null,null);return r.instrumentConformed=function(n){return i(r,n,{conform:!0,instrument:!0})},r.instrument=function(n){return i(r,n,{conform:!1,instrument:!0})},r}var o=e(1),i=e(10);n.exports=t},function(n,r){n.exports=function(n){return void 0===n}},function(n,r,e){function t(n,r,e){var t=o(n);return t(r,e)}function o(n){var r,e=v(n);if(["OR","CAT","Z_OR_M","O_OR_M","Z_OR_O"].indexOf(e.type)>=0)r=i;else if(["COLL_OF"].indexOf(e.type)>=0)r=c;else if("PRED"===e.type)r=u;else if("PROPS"===e.type)r=f;else if("AND"===e.type)r=s;else if("SpecRef"===e.type)r=l;else if("Delayed"===e.type)r=p;else{if("FSPEC"!==e.type)throw"unsupported type "+e.type;r=a}var o=r(e,t);return o.isProblem&&"PROPS"===e.type&&console.log(o),o}var i=e(49),u=e(50),a=e(48),f=e(51),s=e(45),c=e(46),l=e(52),p=e(47),v=e(6);n.exports=t},function(n,r,e){function t(n){return p(n,function(r){var e;if(r.named){e=r.named;var t=e.map(function(n){var r=n.expr;if(r.spec){var e=r.spec;return i({},n,{expr:e,spec:void 0})}if(r.pred){var e=h(r.pred);return i({},n,{expr:e,pred:void 0})}if(r.specRef){var e=r.specRef;return i({},n,{expr:e,specRef:void 0})}if(r.delayedSpec){var e=r.delayedSpec;return i({},n,{expr:e,delayedSpec:void 0})}throw console.error(n),"Not implemented"}),o=new u(n,t,null,null,null);return o.conform=function(n){return x(o,n,{conform:!0})},o}if(r.unnamed){e=r.unnamed;var t=e.map(function(n){if(n.spec){var r=n.spec;return i({},n,{expr:r,spec:void 0})}if(n.pred){var r=h(n.pred);return i({},n,{expr:r,pred:void 0})}if(n.specRef){var r=n.specRef;return i({},n,{expr:r,specRef:void 0})}if(n.delayedSpec){var r=n.delayedSpec;return i({},n,{expr:r,delayedSpec:void 0})}throw console.error(n),"Not implemented"}),o=new u(n,t,null,null,null);return o.conform=function(n){return x(o,n,{conform:!0})},o}})}function o(n){return p(n,function(r){var e,t=r.expr,o=r.opts;if(t.spec)e=t.spec;else if(t.pred)e=h(t.pred);else if(t.specRef)e=t.specRef;else{if(!t.delayedSpec)throw"internal err";e=t.delayedSpec}var i=new u(n,[h(e)],o,null,null);return i.conform=function(n){return x(i,n,{conform:!0})},i})}var i=e(4),u=e(1),a=e(3),f=e(7),s=e(21),c=e(5),l=e(43),p=e(28),v=e(27),d=e(25),m=e(33),h=e(6),y=e(8),x=e(10),g=h(a),O=h(l),b=t(m.CAT),w=t(m.OR),_=o(m.Z_OR_M),S=o(m.O_OR_M),R=o(m.Z_OR_O),E=o(m.COLL_OF),P=w({named:[{name:"specRef",expr:{spec:v}},{name:"pred",expr:{pred:f}},{name:"delayedSpec",expr:{spec:d}},{name:"spec",expr:{pred:a}}]}),k=b({named:[{name:"name",expr:{spec:O}},{name:"expr",expr:{spec:P}}]}),j=b({named:[{name:"name",expr:{spec:O}},{name:"comment",expr:{spec:c}},{name:"expr",expr:{spec:P}}]}),A=w({unnamed:[{spec:k},{spec:j}]}),C=w({named:[{name:"named",expr:{spec:w({unnamed:[{spec:_({expr:{spec:A}})},{spec:E({expr:{spec:A}})}]})}},{name:"unnamed",expr:{spec:_({expr:{spec:P}})}}]}),M={args:C,ret:g},D={args:b({named:[{name:"expr",expr:{spec:P}},{name:"opts",expr:{spec:R({expr:{pred:s}})}}]}),ret:g},F=y(D).instrumentConformed(E),N={cat:y(M).instrumentConformed(b),or:y(M).instrumentConformed(w),zeroOrMore:y(D).instrumentConformed(_),zeroOrOne:y(D).instrumentConformed(R),oneOrMore:y(D).instrumentConformed(S),ExprSpec:P,collOf:F,arrayOf:F};N.alt=N.or,N["*"]=N.zeroOrMore,N["+"]=N.oneOrMore,N["?"]=N.zeroOrOne,n.exports=N},function(n,r){function e(n){var r={};return(n||!1)&&"[object Function]"===r.toString.call(n)}n.exports=e},function(n,r){function e(n){var r=n.toString();return r=r.substr("function ".length),r=r.substr(0,r.indexOf("("))}n.exports=e},function(n,r,e){var t=e(4),o=e(11),i=e(18),u=i.props,a=i.keys,f={and:e(31),any:e(32),fspec:e(8)},s=t({},o,{props:u,keys:a},f);n.exports=s},function(n,r,e){var t=e(20),o=e(39),i=e(19),u=e(38),a=e(12),f=e(21),s=e(5),c=Array.isArray;n.exports={isNull:e(40),isUndefined:e(9),notEmpty:e(41),isBool:u,isBoolean:u,isFn:a,isFunction:a,isNum:t,isNumber:t,isNatInt:o,isNaturalNumber:o,isInt:i,isInteger:i,isObj:f,isObject:f,isStr:s,isString:s,isArray:c}},function(n,r){function e(n){var r=n.getFn;this.type="Delayed",this.get=r;var e=this;["conform","instrument"].forEach(function(n){e[n]=function(e){var t=r();return t[n].call(this,e)}})}n.exports=e},function(n,r){function e(n){var r=n.ref,e=n.getFn,t=n.conformFn;this.type="SpecRef",this.get=e,this.conform=t,this.ref=r}n.exports=e},function(n,r,e){function t(n){return a(n)}function o(n){var r=new i(h,[n],null,null,null);return r.conform=function(n){return d(r,n,{conform:!0})},r}var i=e(1),u=e(3),a=e(5),f=(e(12),e(6)),s=e(11),c=s.cat,l=s.or,p=s.zeroOrMore,v=s.ExprSpec,d=e(10),m=e(8),h="PROPS",y=o({propArgs:{opt:{fieldDefs:{fields:{fields:{keyValExprPair:{keySpec:{spec:f(a)},valSpec:{spec:l("valExprOnly",v,"keyValExprPair",c("keySpec",v,"valSpec",v))}}}}}}}}),x=p(t),g=l("keyList",x,"fieldDefs",y),O=o({propArgs:{opt:{fieldDefs:{fields:{req:{valExprOnly:{spec:g}},opt:{valExprOnly:{spec:g}}}}}}}),b=m({args:c("propArgs",O),ret:u}),w=b.instrumentConformed(o);n.exports={props:w,keys:w}},function(n,r){function e(n){return"number"==typeof n&&(Math.floor(n)===n&&n!==1/0)}n.exports=e},function(n,r){function e(n){return"number"==typeof n}n.exports=e},function(n,r){function e(n){return"object"===("undefined"==typeof n?"undefined":t(n))&&null!==n}var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n};n.exports=e},function(n,r,e){function t(n,r){if(n&&o(n)){var e=n.conform(r);return e}throw new Error("Expression needs to be of type Spec. expression: "+n+", offending value: "+r)}var o=e(3);n.exports=t},function(n,r,e){function t(n){return new o({getFn:n})}var o=e(16);n.exports=t},function(n,r){function e(n){return n}n.exports=e},function(n,r,e){var t=e(16);n.exports=function(n){return n instanceof t}},function(n,r,e){function t(n){return o(n)||i(n)}var o=e(7),i=e(3);n.exports=t},function(n,r,e){var t=e(17);n.exports=function(n){return n instanceof t}},function(n,r){function e(n,r,e){return n?new Function("action","return function "+n+(e||"")+"(){ return action.apply(this, arguments); };")(r):r}n.exports=e},function(n,r,e){(function(r){function t(n){return w(n)}function o(n){var r=function(r){var e=c;e=r?r+c:c;var t=l.get(e,n);return t?t.expr:void 0},e=new p({ref:n,getFn:r,null:null});return e.conform=function(n){return R(ss,n,{conform:!0})},e}function i(n){var r;if(n.def){var e=n.def.name,t=n.def.val;r=u(e,t)}else if(n.get){var e=n.get.name,o=P(e);r=o}return r}function u(n,r){if(r.expr){var e=r.expr;if(e.spec||e.pred){var t=e.spec||e.pred;return C(n,{expr:t}),t}throw console.error(e),"internal erro"}if(!r.partialRefMap)throw console.error(r),"no impl";var o=r.partialRefMap.refDefs;for(var i in o)if(o.hasOwnProperty(i)){u(o[i])}}function a(n){return n instanceof p}function f(){return c||s(),c}function s(){c=r[M]={}}var c,l=e(53),p=e(17),v=e(14),d=v.cat,m=v.or,h=v.fspec,y=v.ExprSpec,x=e(18),g=x.props,O=e(3),b=e(7),w=e(5),_=e(26),S=e(9),R=e(10),E=e(23),P=h({args:d(t),ret:a}).instrument(o),k=m("expr",E(function(){return y})),j=h({args:m("def",d("name",t,"val",k),"get",d("name",t)),ret:m(a,_)}),A=g({req:{expr:m(O,b)}}),C=h({args:d(t,A),ret:S}).instrument(function(n,r){f(),l.set(c,n,r)}),M="___SPECKY_REGISTRY";f();var D=j.instrumentConformed(i);D.clearRegistry=s,n.exports=D}).call(r,e(54))},function(n,r,e){n.exports={conform:e(22),isValid:e(44),identity:e(24),isProblem:e(2),delayed:e(23)}},function(n,r,e){function t(n){var r=n.exprs,e=new f("AND",r,null,null,null);return e.conform=function(n,r){walk(e,n,r)},e}var o=e(15),i=(o.isBool,o.isFn),u=e(26),a=e(3),f=(e(2),e(1)),s=(e(0),e(11)),c=s.oneOrMore,l=s.zeroOrOne,p=(s.or,s.cat),v=e(8),d=v({args:p("exprs",c(u),"walker",l(i)),ret:a});n.exports=d.instrumentConformed(t)},function(n,r,e){function t(){return new o(u,[],null,i,null)}var o=e(1),i=e(24),u="ANY";n.exports=t},function(n,r){n.exports={CAT:"CAT",OR:"OR",Z_OR_M:"Z_OR_M",Z_OR_O:"Z_OR_O",O_OR_M:"O_OR_M",PRED:"PRED",COLL_OF:"COLL_OF"}},function(n,r,e){function t(n){var r;if(null===n.type)throw"Spec has no type: "+n;r=n.type in f?f[n.type]:f.PRED;var e=r(n);return e}function o(n){return new u("ROOT",[n],null,null,null)}var i=e(35),u=e(1),a=function(n){for(var r=0,e=[n.head],t=[];e.length>0;){var o=e.pop();null===o.index&&(o.index=r,r++,o.transitions.forEach(function(n){e.push(n.target)}),t.push(o))}return t},f={},s=function(n){return function(r){var e=t(r.exprs[0]);return n(e)}},c=function(n){return function(r){var e=r.exprs.map(function(n){var r=t(n.expr);return r.name=n.name,r});return n(e)}};["ROOT","Z_OR_M","O_OR_M","Z_OR_O"].forEach(function(n){f[n]=s(i[n])}),["OR","CAT"].forEach(function(n){f[n]=c(i[n])}),f.PRED=function(n){return i.PRED(n)};var l=function(n){var r,e=o(n),i=t(e),u=a(i),f=u.length,s={};return u.forEach(function(n){0===n.transitions.length&&(r=n.index);var e={};n.transitions.forEach(function(n){e[n.target.index]=n.spec}),s[n.index.toString()]=e}),{initialState:0,numStates:f,finalState:r,transitions:s,expression:n}};n.exports=l},function(n,r){function e(n,r){n.forEach(function(n){n.target=r})}function t(){return{isEpsilon:!0}}function o(n,r,e,o){var i=t();return i.name=r,i.op=e,i.group=o,i.dir=n,i}function i(n,r){var e=f(n,r.head),t=a([e]),o=s(t,r.tails);return o}function u(n,r){var t=f(n,null),o=a([t],null);e(r.tails,o);var i=s(r.head,[t]);return i}var a=function(n,r){return{transitions:null===n?[]:n,index:r||null}},f=function(n,r){return{spec:n,target:r}},s=function(n,r){return{head:n,tails:r}},c=function(n,r,e){var t=s(r,e);return t.name=n,t},l={};l.PRED=function(n){var r=f(n,null),e=a([r],null),t=[r],o=s(e,t);return o},l.CAT=function(n){var r=function(n,r){e(n.tails,r.head);var t=n.head,o=r.tails,i=s(t,o);return i};n=n.map(function(n){var r=f(o("out",n.name,"CAT"),null),t=a([r]);e(n.tails,t);var i=n.head.transitions.map(function(r){var e=a([r]),t=f(o("in",n.name,"CAT"),e);return t}),u=a(i),s=c(n.name,u,[r]);return s});var l;if(n.length>0)l=n.reduce(r);else{var p=t(),v=f(p,null),d=a([v]);l=s(d,[v])}return l=i(o("multi_enter",null,"CAT","in"),l),l=u(o("multi_exit",null,"CAT","out"),l)},l.OR=function(n){n=n.map(function(n){var r=o("out",n.name,"OR"),t=f(r,null),i=a([t]);e(n.tails,i);var u=f(o("in",n.name,"OR"),n.head),s=a([u]),l=c(n.name,s,[t]);return l});var r=function(n,r){var e=n.head.transitions.concat(r.head.transitions),t=a(e),o=n.tails.concat(r.tails),i=c(n.name,t,o);return i},t=n.reduce(r);return t=i(o("enter",null,"OR"),t),t=u(o("exit",null,"OR"),t)},l.Z_OR_M=function(n){var r="Z_OR_M",c=f(o("loop",null,r),n.head),l=f(t(),null),p=a([c,l]);e(n.tails,p);var v=s(p,[l]),d=v.head.transitions.map(function(n){var r=a([n]),e=f(t(),r);return e}),m=a(d);return v=s(m,v.tails),v=i(o("maybe_enter",null,r,"in"),v),v=u(o("maybe_exit",null,r,"out"),v)},l.O_OR_M=function(n){var r="O_OR_M",c=f(o("loop",null,r),n.head),l=f(t(),null),p=a([c,l]);e(n.tails,p);var v=s(n.head,[l]);return v=i(o("maybe_enter",null,r,"in"),v),v=u(o("maybe_exit",null,r,"out"),v)},l.Z_OR_O=function(n){var r="Z_OR_O",e=f(o("loop",null,r),n.head),c=f(t(),null),l=a([e,c]),p=n.tails.concat([c]),v=s(l,p);return v=i(o("maybe_single_enter",null,r),v),v=u(o("maybe_single_exit",null,r),v)},l.ROOT=function(n){var r=a(null,null);return e(n.tails,r),s(n.head,[])},n.exports=l},function(n,r,e){function t(n,r,e){var t=e.conform,d=(e.instrument,[]),m={};if(n.forEach(function(n){if(n.move)switch(n.move.dir){case"enter":d.push(f);break;case"multi_enter":d.push(s);break;case"maybe_enter":d.push(c);break;case"maybe_single_enter":d.push(l);break;case"in":d.push(new p(n.move.name));break;case"loop":null!==d[d.length-1]&&d.push(a);break;case"pred":d.push(n.conformed);break;case"out":var r=d.pop();if(!(r instanceof p)){var e,m=d.pop().value;null!==m&&void 0!==m&&t?(e={},u(r)||(e[m]=r)):e=new v(r),d.push(e)}break;case"maybe_single_exit":for(var h=d.pop(),y=null;h!==l;)h!==a&&(y=h),h=d.pop();null===y&&(y=void 0),d.push(y);break;case"maybe_exit":for(var h=d.pop(),y=null;h!==c;)h!==a&&(y=o(y,h)),h=d.pop();null===y&&(y=[]),d.push(y);break;case"multi_exit":for(var h=d.pop(),y=null;h!==s;)y=h instanceof v?null===y?[h.value]:[h.value].concat(y):i({},h,y),h=d.pop();null===y&&(y=[]),d.push(y);break;case"exit":for(var h=d.pop(),y=null;h!==f;)y=h instanceof v?null===y?h.value:[h.value].concat(y):i({},h,y),h=d.pop();null===y&&(y=[]),d.push(y);break;default:throw console.error(n),"FUUU"}}),1!==d.length)throw console.error(d),"FUUU2";var m=d.pop();return m}function o(n,r){var e;return e=null===n?[r]:Array.isArray(n)?[r].concat(n):[r,n]}var i=e(4),u=(e(0),e(9)),a=function(){},f=function(){},s=function(){},c=function(){},l=function(){},p=function(n){this.value=n},v=function(n){this.value=n};n.exports=t},function(n,r,e){function t(n,r,e,t){for(var u,a=t.conform,f=t.instrument,s=t.trailblaze,c={matched:!1,chain:null},l={state:0,offset:0,leftOff:0,input:[r],groupCount:0,arrayed:!1},p=[l];p.length>0;){var v=p.shift(),d=v.offset,m=v.leftOff,u=v.input,h=v.groupCount,y=v.arrayed;if(v.state===n.finalState&&d===u.length)return c.matched=!0,c.chain=o(n,v,e,t),c;for(var x in n.transitions[v.state]){var g=parseInt(x),O=u[d],b=n.transitions[v.state][g];"in"===b.group?(0===h&&Array.isArray(u[0])&&(u=u[0],d=0,y=!0),h+=1):"out"===b.group&&(h-=1,0===h&&(y&&(d=d===u.length?1:0,u=[u]),y=!1));var w,_;w=b.isEpsilon?d:d+1;var S,R;w<=u.length&&(b.isEpsilon?(_=b.dir?{dir:b.dir,name:b.name,op:b.op,group:b.group}:null,R={input:u,groupCount:h,arrayed:y,leftOff:m,state:g,offset:w,move:_,spec:b,prev:v,isEpsilon:!0},p.push(R)):(a||f||s)&&(S=e(b,O,{trailblaze:!0}),i(S)?c.lastProblem=S:d<u.length&&(_={dir:"pred"},R={input:u,groupCount:h,arrayed:y,leftOff:m,state:g,offset:w,move:_,prev:v,isEpsilon:!1,spec:b,observed:O},p.push(R))))}}return c}function o(n,r,e,t){for(var o,i=[],u=r;u;){if(!o||u.state!==o.state&&u.move){var a={isEpsilon:u.isEpsilon,move:u.move,state:u.state};u.isEpsilon||(a.observed=u.observed,a.conformed=e(u.spec,u.observed,t)),i.unshift(a)}o=u,u=u.prev}return i}var i=e(2);n.exports=t},function(n,r){function e(n){return"boolean"==typeof n}n.exports=e},function(n,r,e){function t(n){return o(n)&&n>=0}var o=e(19);n.exports=t},function(n,r){function e(n){return null===n}n.exports=e},function(n,r){n.exports=function(n){return!!n&&0!==n.length}},function(n,r){function e(n){throw n}n.exports=e},function(n,r,e){var t=e(5);n.exports=function(n){return t(n)}},function(n,r,e){function t(n,r){if(n)return u(n)?!o(a(n,r)):!i(n)||n(r);throw new Error("Spec is required")}var o=(e(0),e(2)),i=e(7),u=e(3),a=e(22);n.exports=t},function(n,r,e){function t(n,r){var e=n.exprs;return function(n,t){var u=t.conform,a=t.instrument,f=t.trailblaze;if(u||a||f){var s;f||(s=[]);for(var c=n,l=0;l<e.length;l+=1)if(c=r(e[l],n,t),i(c)){if(f)return c;s.push(c)}return s&&0!==s.length?new o(n,e,s,"One or more expressions failed AND test"):u?c:n}throw"no impl"}}var o=e(0),i=e(2);n.exports=t},function(n,r,e){function t(n,r){var e=n.exprs[0],t=n.opts;return function(a,f){var s=f.conform,c=f.instrument,l=f.trailblaze;if(s||c||l){if(Array.isArray(a)){if(t){var p=t.maxCount,v=t.minCount;if(u(p)&&a.length>p)return new o(a,n,d,"collOf: collection size "+a.length+" exceeds maxCount "+p+".");if(u(v)&&a.length<v)return new o(a,n,d,"collOf: collection size "+a.length+" is less than minCount "+v+".")}var d,m;l||(d=[]),m=[];for(var h=0;h<a.length;h+=1){var y=r(e,a[h],f);if(i(y)){if(l)return y;d.push(y)}else m.push(y)}return d&&0!==d.length?new o(a,n,d,"One or more elements failed collOf test"):m}return new o(a,n,[],"collOf expects an array")}throw"no impl"}}var o=(e(6),e(0)),i=e(2),u=e(20);n.exports=t},function(n,r){function e(n,r){return function(e,t){var o=n.get();if(o)return r(o,e,t)}}n.exports=e},function(n,r,e){function t(n,r){function e(n,r){var e=u(n),t=s(e,n,r),o=a(e,t,"__instrumented");return o}function t(n,r){var e=u(n),t=v(e,n,r),o=a(e,t,"__conformed");return o}function s(n,e,t){return function(){var o=Array.from(arguments),i=l(e,n,o,t),u=e.apply(this,i),a=p(e,n,u,t),f=r(m,o,{conform:!0});return c(n,e,y,f,u),a}}function c(r,e,t,o,u){if(t){var a=t.call(null,o,u);if(!a){var s=new i(e,n,[],"Function "+r+" failed valiation on argument-return value relation");f(s)}}}function l(e,t,u,a){if(!m)return u;var s=r(m,u,a);if(!o(s))return s;var c=new i(u,n,[s],"Arguments "+JSON.stringify(u)+" for function "+t+" failed validation");f(c)}function p(e,t,u,a){if(!h)return u;var s=r(h,u,a);if(!o(s))return s;var c=new i(u,n,[s],"Return value "+u+" for function "+t+" is not valid.");f(c)}function v(n,e,t){return function(){var u=Array.from(arguments),a=r(m,u,t);if(o(a)){var s=new i(u,m,[a],"Args "+JSON.stringify(u)+" for function "+n+" is not valid");f(s)}var l=e(a);return p(e,n,l,t),c(n,e,y,a,l),l}}var d=n.opts,m=d.args,h=d.ret,y=d.fn;return function(r,o){if(!r)return new i(r,n,[],"function is not specified");var u=o.conform,a=o.instrument,f=o.trailblaze;return u&&a?t(r,o):a?e(r,o):f?r:void 0}}var o=e(2),i=e(0),u=e(13),a=e(28),f=e(42);n.exports=t},function(n,r,e){function t(n,r){var e;return function(t,f){var s=f.conform,c=f.instrument,l=f.trailblaze;if(s||c||l){e||(e=u(n));var p=o(e,t,r,f),v=p.chain,d=p.matched,m=p.lastProblem;if(d===!0){var h=i(v,r,f);return h}var y=[];if(m&&y.push(m),s||c||l)return new a(t,n,[],"Spec "+n.type+" did not match val: "+JSON.stringify(t));throw console.error(f),"no impl case"}}}var o=e(37),i=e(36),u=e(34),a=e(0);n.exports=t},function(n,r,e){function t(n,r){return function(r,e){var t=e.conform,u=e.instrument,a=e.trailblaze;if(t||u||a){var f=n.exprs[0];return f(r)?r:new i(r,n,[],"Predicate "+o(f)+" returns false on value "+JSON.stringify(r))}throw"no impl"}}var o=e(13),i=e(0);n.exports=t},function(n,r,e){function t(n,r){var e,t=n.exprs[0].propArgs,a=t.req,p=t.opt;return function(t,v){t.keyList;var d=v.conform,m=v.instrument,h=v.trailblaze;if(d||m||h){var y,x;a&&(y=a.fieldDefs,x=a.keyList),e||(e=o(a,p,r,v));var g=e(t);if(f(g))return g;var O;d&&(O=[]);var b;if(d||h?b=c({},t):m&&(b=t),y)for(var w in y.fields)if(y.fields.hasOwnProperty(w)){var _=y.fields[w],S=u(t,w,_,r,v),R=S.result,E=S.keysToDel;if(f(R)){if(h)return R;O.push([w,R])}else d&&(i(b,E),s(R)||(b[w]=R))}var P,k;if(p&&(P=p.fieldDefs,k=p.keyList),P)for(var w in P.fields)if(P.fields.hasOwnProperty(w)){var _=P.fields[w],j=u(t,w,_,r,v),R=j.result,E=j.keysToDel;if(f(R)){if(h)return R;O.push([w,R])}else d&&(i(b,E),s(R)||(b[w]=R))}if(d&&O.length>0){for(var A={},C=[],M=0;M<O.length;M++){var D=O[M],F=D[0],N=D[1];C.push(F),A[F]=N}var T=new l(t,n,A,"Some properties failed validation: "+C.join(", "));return T}return b}throw"no impl"}}function o(n,r,e,t){return function(r){if(n){var o,i,u=[],s=n.fieldDefs,c=n.keyList;if(s){i=[];for(var p in s.fields)s.fields.hasOwnProperty(p)&&i.push(p)}else{if(!c)throw"unsupported";i=[].concat(c)}for(var v=0;v<i.length;v++){var p=i[v];if(o=void 0,s&&s.fields[p].keyValExprPair){o=!1;for(var d in r)if(r.hasOwnProperty(d)){var m=a(d,s.fields[p].keyValExprPair.keySpec,e,t);if(!f(m)){o=!0;break}}}else c&&void 0===r[p]&&u.push(p)}if(u.length>0||o===!1)return new l(r,n,[],"req: keys required: "+u.join(", "))}return r}}function i(n,r){for(var e=0;e<r.length;e++)delete n[[r[e]]]}function u(n,r,e,t,o){var i,u=e.valExprOnly,c=e.keyValExprPair,l=[];if(c){var p=c.keySpec,v=c.valSpec;i=void 0;for(var d in n){var m=a(d,p,t,o);if(n!==n[m]&&!f(m)){l.push(m);var h=a(n[m],v,t,o);if(f(h))return{result:h,keysToDel:l};void 0===i&&(i={}),i[d]=h}}}else if(u){var v=u;i=n[r],s(i)||n[r]===n||(i=a(i,v,t,o))}return{result:i,keysToDel:l}}function a(n,r,e,t){if(r.spec){var o=r.spec;return e(o,n,t)}if(r.pred){var i=p(r.pred);return e(i,n,t)}throw console.error(r),"no impl"}var f=e(2),s=e(9),c=e(4),l=e(0),p=e(6);n.exports=t},function(n,r){function e(n,r){return function(e,t){var o=n.get();if(o)return r(ss,e,t)}}n.exports=e},function(n,r,e){var t,o,i;!function(e,u){"use strict";"object"==typeof n&&"object"==typeof n.exports?n.exports=u():(o=[],t=u,i="function"==typeof t?t.apply(r,o):t,!(void 0!==i&&(n.exports=i)))}(this,function(){"use strict";function n(n,r){return null!=n&&Object.prototype.hasOwnProperty.call(n,r)}function r(r){if(!r)return!0;if(f(r)&&0===r.length)return!0;if("string"!=typeof r){for(var e in r)if(n(r,e))return!1;return!0}return!1}function e(n){return a.call(n)}function t(n){return"object"==typeof n&&"[object Object]"===e(n)}function o(n){return"boolean"==typeof n||"[object Boolean]"===e(n)}function i(n){var r=parseInt(n);return r.toString()===n?r:n}function u(e){function u(r,t){if(e.includeInheritedProps||"number"==typeof t&&Array.isArray(r)||n(r,t))return r[t]}function a(n,r,e,t){if("number"==typeof r&&(r=[r]),!r||0===r.length)return n;if("string"==typeof r)return a(n,r.split(".").map(i),e,t);var o=r[0],f=u(n,o);return 1===r.length?(void 0!==f&&t||(n[o]=e),f):(void 0===f&&("number"==typeof r[1]?n[o]=[]:n[o]={}),a(n[o],r.slice(1),e,t))}e=e||{};var s=function(n){return Object.keys(s).reduce(function(r,e){return"create"===e?r:("function"==typeof s[e]&&(r[e]=s[e].bind(s,n)),r)},{})};return s.has=function(r,t){if("number"==typeof t?t=[t]:"string"==typeof t&&(t=t.split(".")),!t||0===t.length)return!!r;for(var o=0;o<t.length;o++){var u=i(t[o]);if(!("number"==typeof u&&f(r)&&u<r.length||(e.includeInheritedProps?u in Object(r):n(r,u))))return!1;r=r[u]}return!0},s.ensureExists=function(n,r,e){return a(n,r,e,!0)},s.set=function(n,r,e,t){return a(n,r,e,t)},s.insert=function(n,r,e,t){var o=s.get(n,r);t=~~t,f(o)||(o=[],s.set(n,r,o)),o.splice(t,0,e)},s.empty=function(e,i){if(!r(i)&&null!=e){var u,a;if(u=s.get(e,i)){if("string"==typeof u)return s.set(e,i,"");if(o(u))return s.set(e,i,!1);if("number"==typeof u)return s.set(e,i,0);if(f(u))u.length=0;else{if(!t(u))return s.set(e,i,null);for(a in u)n(u,a)&&delete u[a]}}}},s.push=function(n,r){var e=s.get(n,r);f(e)||(e=[],s.set(n,r,e)),e.push.apply(e,Array.prototype.slice.call(arguments,2))},s.coalesce=function(n,r,e){for(var t,o=0,i=r.length;o<i;o++)if(void 0!==(t=s.get(n,r[o])))return t;return e},s.get=function(n,r,e){if("number"==typeof r&&(r=[r]),!r||0===r.length)return n;if(null==n)return e;if("string"==typeof r)return s.get(n,r.split("."),e);var t=i(r[0]),o=u(n,t);return void 0===o?e:1===r.length?o:s.get(n[t],r.slice(1),e)},s.del=function(n,e){if("number"==typeof e&&(e=[e]),null==n)return n;if(r(e))return n;if("string"==typeof e)return s.del(n,e.split("."));var t=i(e[0]),o=u(n,t);if(null==o)return o;if(1===e.length)f(n)?n.splice(t,1):delete n[t];else if(void 0!==n[t])return s.del(n[t],e.slice(1));return n},s}var a=Object.prototype.toString,f=Array.isArray||function(n){return"[object Array]"===a.call(n)},s=u();return s.create=u,s.withInheritedProps=u({includeInheritedProps:!0}),s})},function(n,r){var e;e=function(){return this}();try{e=e||Function("return this")()||(0,eval)("this")}catch(n){"object"==typeof window&&(e=window)}n.exports=e},function(n,r,e){var t=e(4),o=e(29),i=e(14),u=e(30),a=e(15),f={Problem:e(0),Spec:e(1)},s=t(o,i,u,f,a);n.exports=s}])});