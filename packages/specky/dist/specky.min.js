!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define("S",[],r):"object"==typeof exports?exports.S=r():e.S=r()}(this,function(){return function(e){function r(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,r),o.l=!0,o.exports}var n={};return r.m=e,r.c=n,r.i=function(e){return e},r.d=function(e,r,n){Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(n,"a",n),n},r.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},r.p="",r(r.s=55)}([function(e,r){function n(e,r,n,t){if(this.isProblem=!0,4!==arguments.length)throw"Problem arg len err";this.val=e,this.name="Problem",this.failsPredicate=r,this.problemMessage=t,this.stack=(new Error).stack,this.message=t,this.subproblems=n}n.prototype=new Error,e.exports=n},function(e,r){function n(e,r,n,t,o){if(5!==arguments.length)throw new Error("Wrong number of arguments ("+arguments.length+") passed to Spec constructor");if(!Array.isArray(r))throw new Error("Expect an array of specs");this.type=e,n&&(this.opts=n),t&&(this.conform=t),o&&(this.generate=o),this.exprs=r}e.exports=n},function(e,r,n){function t(e){return e instanceof o}var o=n(0);e.exports=t},function(e,r,n){function t(e){return!!e&&e instanceof o}var o=n(1);e.exports=t},function(e,r){"use strict";function n(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function t(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var r={},n=0;n<10;n++)r["_"+String.fromCharCode(n)]=n;var t=Object.getOwnPropertyNames(r).map(function(e){return r[e]});if("0123456789"!==t.join(""))return!1;var o={};return"abcdefghijklmnopqrst".split("").forEach(function(e){o[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},o)).join("")}catch(e){return!1}}var o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;e.exports=t()?Object.assign:function(e,r){for(var t,u,a=n(e),f=1;f<arguments.length;f++){t=Object(arguments[f]);for(var s in t)o.call(t,s)&&(a[s]=t[s]);if(Object.getOwnPropertySymbols){u=Object.getOwnPropertySymbols(t);for(var c=0;c<u.length;c++)i.call(t,u[c])&&(a[u[c]]=t[u[c]])}}return a}},function(e,r){function n(e){return null!==e&&void 0!==e&&e.constructor===String}e.exports=n},function(e,r,n){function t(e){if(a(e)||f(e)||s(e))return e;if(u(e))return o(e);throw new Error("Expression must either be a Spec object or a predication function that returns true or false. ")}function o(e){return new c(v,[e],null,i(e),null)}function i(e){return function(r){return e(r)?r:new l(r,e,[],"Predicate "+p(e)+" returns false on value "+JSON.stringify(r))}}var u=n(7),a=n(3),f=n(27),s=n(25),c=n(1),l=n(0),p=n(13),v="PRED";e.exports=t},function(e,r,n){function t(e){return o(e)}var o=n(12);n(1);e.exports=t},function(e,r,n){function t(e){var r=new o("FSPEC",[],e,null,null);return r.instrumentConformed=function(e){return i(r,e,{conform:!0,instrument:!0})},r.instrument=function(e){return i(r,e,{conform:!1,instrument:!0})},r}var o=n(1),i=n(10);e.exports=t},function(e,r){e.exports=function(e){return void 0===e}},function(e,r,n){function t(e,r,n){var t=n.phase,u=(n.conform,n.instrument,o(e));if(t){if(u[t])return u[t](r,n);throw"!"}var a=u.trailblaze(r,i({phase:"trailblaze"},n));return m(a)?a:u.reconstruct(a,i({phase:"reconstruct"},n))}function o(e){var r,n=d(e);if(["OR","CAT","Z_OR_M","O_OR_M","Z_OR_O"].indexOf(n.type)>=0)r=u;else if(["COLL_OF"].indexOf(n.type)>=0)r=l;else if("PRED"===n.type)r=a;else if("PROPS"===n.type)r=s;else if("AND"===n.type)r=c;else if("SpecRef"===n.type)r=p;else if("Delayed"===n.type)r=v;else{if("FSPEC"!==n.type)throw"unsupported type "+n.type;r=f}var o=r(n,t);return o}var i=n(4),u=n(49),a=n(50),f=n(48),s=n(51),c=n(45),l=n(46),p=n(52),v=n(47),d=n(6),m=n(2);e.exports=t},function(e,r,n){function t(e){return p(e,function(r){var n;if(r.named){n=r.named;var t=n.map(function(e){var r=e.expr;if(r.spec){var n=r.spec;return i({},e,{expr:n,spec:void 0})}if(r.pred){var n=h(r.pred);return i({},e,{expr:n,pred:void 0})}if(r.specRef){var n=r.specRef;return i({},e,{expr:n,specRef:void 0})}if(r.delayedSpec){var n=r.delayedSpec;return i({},e,{expr:n,delayedSpec:void 0})}throw console.error(e),"Not implemented"}),o=new u(e,t,null,null,null);return o.conform=function(e){return x(o,e,{})},o}if(r.unnamed){n=r.unnamed;var t=n.map(function(e){if(e.spec){var r=e.spec;return i({},e,{expr:r,spec:void 0})}if(e.pred){var r=h(e.pred);return i({},e,{expr:r,pred:void 0})}if(e.specRef){var r=e.specRef;return i({},e,{expr:r,specRef:void 0})}if(e.delayedSpec){var r=e.delayedSpec;return i({},e,{expr:r,delayedSpec:void 0})}throw console.error(e),"Not implemented"}),o=new u(e,t,null,null,null);return o.conform=function(e){return x(o,e,{})},o}})}function o(e){return p(e,function(r){var n,t=r.expr,o=r.opts;if(t.spec)n=t.spec;else if(t.pred)n=h(t.pred);else if(t.specRef)n=t.specRef;else{if(!t.delayedSpec)throw"internal err";n=t.delayedSpec}var i=new u(e,[h(n)],o,null,null);return i.conform=function(e){return x(i,e,{})},i})}var i=n(4),u=n(1),a=n(3),f=n(7),s=n(21),c=n(5),l=n(43),p=n(28),v=n(27),d=n(25),m=n(33),h=n(6),y=n(8),x=n(10),g=h(a),b=h(l),O=t(m.CAT),w=t(m.OR),_=o(m.Z_OR_M),S=o(m.O_OR_M),R=o(m.Z_OR_O),k=o(m.COLL_OF),E=w({named:[{name:"specRef",expr:{spec:v}},{name:"pred",expr:{pred:f}},{name:"delayedSpec",expr:{spec:d}},{name:"spec",expr:{pred:a}}]}),P=O({named:[{name:"name",expr:{spec:b}},{name:"expr",expr:{spec:E}}]}),j=O({named:[{name:"name",expr:{spec:b}},{name:"comment",expr:{spec:c}},{name:"expr",expr:{spec:E}}]}),A=w({unnamed:[{spec:P},{spec:j}]}),C=w({named:[{name:"named",expr:{spec:w({unnamed:[{spec:_({expr:{spec:A}})},{spec:k({expr:{spec:A}})}]})}},{name:"unnamed",expr:{spec:_({expr:{spec:E}})}}]}),z={args:C,ret:g},M={args:O({named:[{name:"expr",expr:{spec:E}},{name:"opts",expr:{spec:R({expr:{pred:s}})}}]}),ret:g},D=y(M).instrumentConformed(k),F={cat:y(z).instrumentConformed(O),or:y(z).instrumentConformed(w),zeroOrMore:y(M).instrumentConformed(_),zeroOrOne:y(M).instrumentConformed(R),oneOrMore:y(M).instrumentConformed(S),ExprSpec:E,collOf:D,arrayOf:D};F.alt=F.or,F["*"]=F.zeroOrMore,F["+"]=F.oneOrMore,F["?"]=F.zeroOrOne,e.exports=F;var N=w({named:[{name:"named",expr:{spec:w({unnamed:[{spec:_({expr:{spec:A}})},{spec:k({expr:{spec:A}})}]})}},{name:"unnamed",expr:{spec:_({expr:{spec:E}})}}]});console.log(N.conform(["aaa",N,"bbb",N]))},function(e,r){function n(e){var r={};return(e||!1)&&"[object Function]"===r.toString.call(e)}e.exports=n},function(e,r){function n(e){var r=e.toString();return r=r.substr("function ".length),r=r.substr(0,r.indexOf("("))}e.exports=n},function(e,r,n){var t=n(4),o=n(11),i=n(18),u=i.props,a=i.keys,f={and:n(31),any:n(32),fspec:n(8)},s=t({},o,{props:u,keys:a},f);e.exports=s},function(e,r,n){var t=n(20),o=n(39),i=n(19),u=n(38),a=n(12),f=n(21),s=n(5),c=Array.isArray;e.exports={isNull:n(40),isUndefined:n(9),notEmpty:n(41),isBool:u,isBoolean:u,isFn:a,isFunction:a,isNum:t,isNumber:t,isNatInt:o,isNaturalNumber:o,isInt:i,isInteger:i,isObj:f,isObject:f,isStr:s,isString:s,isArray:c}},function(e,r){function n(e){var r=e.getFn;this.type="Delayed",this.get=r;var n=this;["conform","instrument"].forEach(function(e){n[e]=function(n){var t=r();return t[e].call(this,n)}})}e.exports=n},function(e,r){function n(e){var r=e.ref,n=e.getFn,t=e.conformFn;this.type="SpecRef",this.get=n,this.conform=t,this.ref=r}e.exports=n},function(e,r,n){function t(e){return a(e)}function o(e){var r=new i(h,[e],null,null,null);return r.conform=function(e){return d(r,e,{})},r}var i=n(1),u=n(3),a=n(5),f=(n(12),n(6)),s=n(11),c=s.cat,l=s.or,p=s.zeroOrMore,v=s.ExprSpec,d=n(10),m=n(8),h="PROPS",y=o({propArgs:{opt:{fieldDefs:{fields:{fields:{keyValExprPair:{keySpec:{spec:f(a)},valSpec:{spec:l("valSpecAltsOnly",v,"keyValExprPair",c("keySpec",v,"valSpec",v))}}}}}}}}),x=p(t),g=l("keyList",x,"fieldDefs",y),b=o({propArgs:{opt:{fieldDefs:{fields:{req:{valSpecAltsOnly:{spec:g}},opt:{valSpecAltsOnly:{spec:g}}}}}}}),O=m({args:c("propArgs",b),ret:u}),w=O.instrumentConformed(o);e.exports={props:w,keys:w}},function(e,r){function n(e){return"number"==typeof e&&(Math.floor(e)===e&&e!==1/0)}e.exports=n},function(e,r){function n(e){return"number"==typeof e}e.exports=n},function(e,r){function n(e){return"object"===("undefined"==typeof e?"undefined":t(e))&&null!==e}var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports=n},function(e,r,n){function t(e,r){if(e&&o(e)){var n=e.conform(r);return n}throw new Error("Expression needs to be of type Spec. expression: "+e+", offending value: "+r)}var o=n(3);e.exports=t},function(e,r,n){function t(e){return new o({getFn:e})}var o=n(16);e.exports=t},function(e,r){function n(e){return e}e.exports=n},function(e,r,n){var t=n(16);e.exports=function(e){return e instanceof t}},function(e,r,n){function t(e){return o(e)||i(e)}var o=n(7),i=n(3);e.exports=t},function(e,r,n){var t=n(17);e.exports=function(e){return e instanceof t}},function(e,r){function n(e,r,n){return e?new Function("action","return function "+e+(n||"")+"(){ return action.apply(this, arguments); };")(r):r}e.exports=n},function(e,r,n){(function(r){function t(e){return w(e)}function o(e){var r=function(r){var n=c;n=r?r+c:c;var t=l.get(n,e);return t?t.expr:void 0},n=new p({ref:e,getFn:r,null:null});return n.conform=function(e){return R(ss,e,{})},n}function i(e){var r;if(e.def){var n=e.def.name,t=e.def.val;r=u(n,t)}else if(e.get){var n=e.get.name,o=E(n);r=o}return r}function u(e,r){if(r.expr){var n=r.expr;if(n.spec||n.pred){var t=n.spec||n.pred;return C(e,{expr:t}),t}throw console.error(n),"internal erro"}if(!r.partialRefMap)throw console.error(r),"no impl";var o=r.partialRefMap.refDefs;for(var i in o)if(o.hasOwnProperty(i)){u(o[i])}}function a(e){return e instanceof p}function f(){return c||s(),c}function s(){c=r[z]={}}var c,l=n(53),p=n(17),v=n(14),d=v.cat,m=v.or,h=v.fspec,y=v.ExprSpec,x=n(18),g=x.props,b=n(3),O=n(7),w=n(5),_=n(26),S=n(9),R=n(10),k=n(23),E=h({args:d(t),ret:a}).instrument(o),P=m("expr",k(function(){return y})),j=h({args:m("def",d("name",t,"val",P),"get",d("name",t)),ret:m(a,_)}),A=g({req:{expr:m(b,O)}}),C=h({args:d(t,A),ret:S}).instrument(function(e,r){f(),l.set(c,e,r)}),z="___SPECKY_REGISTRY";f();var M=j.instrumentConformed(i);M.clearRegistry=s,e.exports=M}).call(r,n(54))},function(e,r,n){e.exports={conform:n(22),isValid:n(44),identity:n(24),isProblem:n(2),delayed:n(23)}},function(e,r,n){function t(e){var r=e.exprs,n=new f("AND",r,null,null,null);return n.conform=function(e,r){walk(n,e,r)},n}var o=n(15),i=(o.isBool,o.isFn),u=n(26),a=n(3),f=(n(2),n(1)),s=(n(0),n(11)),c=s.oneOrMore,l=s.zeroOrOne,p=(s.or,s.cat),v=n(8),d=v({args:p("exprs",c(u),"walker",l(i)),ret:a});e.exports=d.instrumentConformed(t)},function(e,r,n){function t(){return new o(u,[],null,i,null)}var o=n(1),i=n(24),u="ANY";e.exports=t},function(e,r){e.exports={CAT:"CAT",OR:"OR",Z_OR_M:"Z_OR_M",Z_OR_O:"Z_OR_O",O_OR_M:"O_OR_M",PRED:"PRED",COLL_OF:"COLL_OF"}},function(e,r,n){function t(e){var r;if(null===e.type)throw"Spec has no type: "+e;r=e.type in f?f[e.type]:f.PRED;var n=r(e);return n}function o(e){return new u("ROOT",[e],null,null,null)}var i=n(35),u=n(1),a=function(e){for(var r=0,n=[e.head],t=[];n.length>0;){var o=n.pop();null===o.index&&(o.index=r,r++,o.transitions.forEach(function(e){n.push(e.target)}),t.push(o))}return t},f={},s=function(e){return function(r){var n=t(r.exprs[0]);return e(n)}},c=function(e){return function(r){var n=r.exprs.map(function(e){var r=t(e.expr);return r.name=e.name,r});return e(n)}};["ROOT","Z_OR_M","O_OR_M","Z_OR_O"].forEach(function(e){f[e]=s(i[e])}),["OR","CAT"].forEach(function(e){f[e]=c(i[e])}),f.PRED=function(e){return i.PRED(e)};var l=function(e){var r,n=o(e),i=t(n),u=a(i),f=u.length,s={};return u.forEach(function(e){0===e.transitions.length&&(r=e.index);var n={};e.transitions.forEach(function(e){n[e.target.index]=e.spec}),s[e.index.toString()]=n}),{initialState:0,numStates:f,finalState:r,transitions:s,expression:e}};e.exports=l},function(e,r){function n(e,r){e.forEach(function(e){e.target=r})}function t(){return{isEpsilon:!0}}function o(e,r,n,o){var i=t();return i.name=r,i.op=n,i.group=o,i.dir=e,i}function i(e,r){var n=f(e,r.head),t=a([n]),o=s(t,r.tails);return o}function u(e,r){var t=f(e,null),o=a([t],null);n(r.tails,o);var i=s(r.head,[t]);return i}var a=function(e,r){return{transitions:null===e?[]:e,index:r||null}},f=function(e,r){return{spec:e,target:r}},s=function(e,r){return{head:e,tails:r}},c=function(e,r,n){var t=s(r,n);return t.name=e,t},l={};l.PRED=function(e){var r=f(e,null),n=a([r],null),t=[r],o=s(n,t);return o},l.CAT=function(e){var r=function(e,r){n(e.tails,r.head);var t=e.head,o=r.tails,i=s(t,o);return i};e=e.map(function(e){var r=f(o("out",e.name,"CAT"),null),t=a([r]);n(e.tails,t);var i=e.head.transitions.map(function(r){var n=a([r]),t=f(o("in",e.name,"CAT"),n);return t}),u=a(i),s=c(e.name,u,[r]);return s});var l;if(e.length>0)l=e.reduce(r);else{var p=t(),v=f(p,null),d=a([v]);l=s(d,[v])}return l=i(o("multi_enter",null,"CAT","in"),l),l=u(o("multi_exit",null,"CAT","out"),l)},l.OR=function(e){e=e.map(function(e){var r=o("out",e.name,"OR"),t=f(r,null),i=a([t]);n(e.tails,i);var u=f(o("in",e.name,"OR"),e.head),s=a([u]),l=c(e.name,s,[t]);return l});var r=function(e,r){var n=e.head.transitions.concat(r.head.transitions),t=a(n),o=e.tails.concat(r.tails),i=c(e.name,t,o);return i},t=e.reduce(r);return t=i(o("enter",null,"OR"),t),t=u(o("exit",null,"OR"),t)},l.Z_OR_M=function(e){var r="Z_OR_M",c=f(o("loop",null,r),e.head),l=f(t(),null),p=a([c,l]);n(e.tails,p);var v=s(p,[l]),d=v.head.transitions.map(function(e){var r=a([e]),n=f(t(),r);return n}),m=a(d);return v=s(m,v.tails),v=i(o("maybe_enter",null,r,"in"),v),v=u(o("maybe_exit",null,r,"out"),v)},l.O_OR_M=function(e){var r="O_OR_M",c=f(o("loop",null,r),e.head),l=f(t(),null),p=a([c,l]);n(e.tails,p);var v=s(e.head,[l]);return v=i(o("maybe_enter",null,r,"in"),v),v=u(o("maybe_exit",null,r,"out"),v)},l.Z_OR_O=function(e){var r="Z_OR_O",n=f(o("loop",null,r),e.head),c=f(t(),null),l=a([n,c]),p=e.tails.concat([c]),v=s(l,p);return v=i(o("maybe_single_enter",null,r),v),v=u(o("maybe_single_exit",null,r),v)},l.ROOT=function(e){var r=a(null,null);return n(e.tails,r),s(e.head,[])},e.exports=l},function(e,r,n){function t(e,r,n){var t=n.conform,d=(n.instrument,[]),m={};if(e.forEach(function(e){if(e.move)switch(e.move.dir){case"enter":d.push(f);break;case"multi_enter":d.push(s);break;case"maybe_enter":d.push(c);break;case"maybe_single_enter":d.push(l);break;case"in":d.push(new p(e.move.name));break;case"loop":null!==d[d.length-1]&&d.push(a);break;case"pred":var m=r(e.spec,e.observed,n);d.push(m);break;case"out":var h=d.pop();if(!(h instanceof p)){var y,x=d.pop().value;null!==x&&void 0!==x&&t?(y={},u(h)||(y[x]=h)):y=new v(h),d.push(y)}break;case"maybe_single_exit":for(var g=d.pop(),b=null;g!==l;)g!==a&&(b=g),g=d.pop();null===b&&(b=void 0),d.push(b);break;case"maybe_exit":for(var g=d.pop(),b=null;g!==c;)g!==a&&(b=o(b,g)),g=d.pop();null===b&&(b=[]),d.push(b);break;case"multi_exit":for(var g=d.pop(),b=null;g!==s;)b=g instanceof v?null===b?[g.value]:[g.value].concat(b):i({},g,b),g=d.pop();null===b&&(b=[]),d.push(b);break;case"exit":for(var g=d.pop(),b=null;g!==f;)b=g instanceof v?null===b?g.value:[g.value].concat(b):i({},g,b),g=d.pop();null===b&&(b=[]),d.push(b);break;default:throw console.error(e),"FUUU"}}),1!==d.length)throw console.error("valStack",d),"!valStack.length";var m=d.pop();return m}function o(e,r){var n;return n=null===e?[r]:Array.isArray(e)?[r].concat(e):[r,e]}var i=n(4),u=(n(0),n(9)),a=function(){},f=function(){},s=function(){},c=function(){},l=function(){},p=function(e){this.value=e},v=function(e){this.value=e};e.exports=t},function(e,r,n){function t(e,r,n,t){for(var u,a=t.conform,f=t.instrument,s=t.trailblaze,c={matched:!1,chain:null},l={state:0,offset:0,leftOff:0,input:[r],groupCount:0,arrayed:!1},p=[l];p.length>0;){var v=p.shift(),d=v.offset,m=v.leftOff,u=v.input,h=v.groupCount,y=v.arrayed;if(v.state===e.finalState&&d===u.length)return c.matched=!0,c.chain=o(e,v,n,t),c;for(var x in e.transitions[v.state]){var g=parseInt(x),b=u[d],O=e.transitions[v.state][g];"in"===O.group?(0===h&&Array.isArray(u[0])&&(u=u[0],d=0,y=!0),h+=1):"out"===O.group&&(h-=1,0===h&&(y&&(d=d===u.length?1:0,u=[u]),y=!1));var w,_;w=O.isEpsilon?d:d+1;var S,R;w<=u.length&&(O.isEpsilon?(_=O.dir?{dir:O.dir,name:O.name,op:O.op,group:O.group}:null,R={input:u,groupCount:h,arrayed:y,leftOff:m,state:g,offset:w,move:_,spec:O,prev:v,isEpsilon:!0},p.push(R)):(a||f||s)&&(S=n(O,b,{trailblaze:!0}),i(S)?c.lastProblem=S:d<u.length&&(_={dir:"pred"},R={input:u,groupCount:h,arrayed:y,leftOff:m,state:g,offset:w,move:_,prev:v,isEpsilon:!1,spec:O,observed:b},p.push(R))))}}return console.log("z",r,c,e,t),c}function o(e,r,n,t){for(var o,i=[],u=r;u;){if(!o||u.state!==o.state&&u.move){var a={isEpsilon:u.isEpsilon,move:u.move,state:u.state};u.isEpsilon||(a.observed=u.observed,a.spec=u.spec),i.unshift(a)}o=u,u=u.prev}return i}var i=n(2);e.exports=t},function(e,r){function n(e){return"boolean"==typeof e}e.exports=n},function(e,r,n){function t(e){return o(e)&&e>=0}var o=n(19);e.exports=t},function(e,r){function n(e){return null===e}e.exports=n},function(e,r){e.exports=function(e){return!!e&&0!==e.length}},function(e,r){function n(e){throw e}e.exports=n},function(e,r,n){var t=n(5);e.exports=function(e){return t(e)}},function(e,r,n){function t(e,r){if(e)return u(e)?!o(a(e,r)):!i(e)||e(r);throw new Error("Spec is required")}var o=(n(0),n(2)),i=n(7),u=n(3),a=n(22);e.exports=t},function(e,r,n){function t(e,r){function n(e,n){for(var t=(n.trailblaze,e),a=[],f=0;f<u.length;f+=1)if(t=r(u[f],e,n),i(t)){a.push(t);break}return a&&0!==a.length?new o(e,u,a,"One or more expressions failed AND test"):t}function t(e,n){for(var t=e,o=0;o<u.length;o+=1)t=r(u[o],t,n);return t}var u=e.exprs;return{trailblaze:n,reconstruct:t}}var o=n(0),i=n(2);e.exports=t},function(e,r,n){function t(e,r){function n(n,t){if(Array.isArray(n)){if(f){var s=f.maxCount,c=f.minCount;if(u(s)&&n.length>s)return new o(n,e,l,"collOf: collection size "+n.length+" exceeds maxCount "+s+".");if(u(c)&&n.length<c)return new o(n,e,l,"collOf: collection size "+n.length+" is less than minCount "+c+".")}for(var l=[],p=0;p<n.length;p+=1){var v=r(a,n[p],t);if(i(v)){l.push(v);break}}return l.length>0?new o(n,e,l,"One or more elements failed collOf test"):n}return new o(n,e,[],"collOf expects an array")}function t(e,n){for(var t=[],o=0;o<e.length;o+=1){var i=r(a,e[o],n);t.push(i)}return t}var a=e.exprs[0],f=e.opts;return{trailblaze:n,reconstruct:t}}var o=(n(6),n(0)),i=n(2),u=n(20);e.exports=t},function(e,r){function n(e,r){function n(n,t){var o=e.get();if(o)return r(o,n,t)}return{trailblaze:n,reconstruct:n}}e.exports=n},function(e,r,n){function t(e,r){function n(e){return e}function t(r,n){if(!r)return new i(r,e,[],"function is not specified");var t=n.conform,o=n.instrument;return t&&o?c(r,n):o?s(r,n):void 0}function s(e,r){var n=u(e),t=l(n,e,r),o=a(n,t,"__instrumented");return o}function c(e,r){var n=u(e),t=m(n,e,r),o=a(n,t,"__conformed");return o}function l(e,n){return function(){var t=Array.from(arguments),o=v(n,e,t),i=n.apply(this,o),u=d(n,e,i),a=r(y,t,{});return p(e,n,g,a,i),u}}function p(r,n,t,o,u){if(t){var a=t.call(null,o,u);if(!a){var s=new i(n,e,[],"Function "+r+" failed valiation on argument-return value relation");f(s)}}}function v(n,t,u){if(!y)return u;var a=r(y,u,{trailblaze:!0});if(!o(a))return a;var s=new i(u,e,[a],"Arguments "+JSON.stringify(u)+" for function "+t+" failed validation");f(s)}function d(n,t,u){if(!x)return u;var a=r(x,u,{trailblaze:!0});if(!o(a))return a;var s=new i(u,e,[a],"Return value "+u+" for function "+t+" is not valid.");f(s)}function m(e,n){return function(){var t=Array.from(arguments),u=r(y,t,{});if(o(u)){var a=new i(t,y,[u],"Arguments "+JSON.stringify(t)+" for function "+e+" is not valid");f(a)}var s=n(u);return d(n,e,s),p(e,n,g,u,s),s}}var h=e.opts,y=h.args,x=h.ret,g=h.fn;return{trailblaze:n,reconstruct:t}}var o=n(2),i=n(0),u=n(13),a=n(28),f=n(42);e.exports=t},function(e,r,n){function t(e,r){function n(n,t){f||(f=u(e));var i=o(f,n,r,t),s=i.chain,c=i.matched,l=i.lastProblem;if(c===!0)return s;var p=[];return l&&p.push(l),new a(n,e,p,"Spec "+e.type+" did not match val: "+JSON.stringify(n))}function t(e,n){var t=i(e,r,n);return t}var f;return{trailblaze:n,reconstruct:t}}var o=n(37),i=n(36),u=n(34),a=n(0);n(2);e.exports=t},function(e,r,n){function t(e,r){function n(r,n){var t=(n.conform,n.instrument,n.trailblaze,e.exprs[0]);return t(r)?r:new i(r,e,[],"Predicate "+o(t)+" returns false on value "+JSON.stringify(r))}function t(e,r){return e}return{trailblaze:n,reconstruct:t}}var o=n(13),i=n(0);e.exports=t},function(e,r,n){function t(e,r){function n(n,t){var i,s,p=t.conform,m=t.instrument,h=t.trailblaze;v&&(i=v.fieldDefs,s=v.keyList),a||(a=o(v,d,r,t));var y=a(n);if(f(y))return y;var x=[],g={keyGroups:{},keys:[]};if(p||h?g.val=c({},n):m&&(g.val=n),i)for(var b in i.fields)if(i.fields.hasOwnProperty(b)){var O=i.fields[b],w=u(n,b,O,r,t);if(f(w)){x.push([b,w]);break}var _=w.key,S=w.matchedKeys;if(_)g.keys.push(_);else{if(!S)throw"!";g.keyGroups[b]=S}}var R,k;if(d&&(R=d.fieldDefs,k=d.keyList),R)for(var b in R.fields)if(R.fields.hasOwnProperty(b)){var O=i.fields[b],w=u(n,b,O,r,t);if(f(w)){x.push([b,w]);break}var _=w.key,S=w.matchedKeys;if(_)g.keys.push(_);else{if(!S)throw"!";g.keyGroups[b]=S}}if(p&&x.length>0){for(var E={},P=[],j=0;j<x.length;j++){var A=x[j],C=A[0],z=A[1];P.push(C),E[C]=z}var M=new l(n,e,E,"Some properties failed validation: "+P.join(", "));return M}return conformed}function t(n,t){var p=t.conform,m=t.instrument,h=t.trailblaze;if(p||m||h){var y,x;v&&(y=v.fieldDefs,x=v.keyList),a||(a=o(v,d,r,t));var g=a(n);if(f(g))return g;var b;p&&(b=[]);var O;if(p||h?O=c({},n):m&&(O=n),y)for(var w in y.fields)if(y.fields.hasOwnProperty(w)){var _=y.fields[w],S=u(n,w,_,r,t),R=S.result,k=S.keysToDel;if(f(R)){if(h)return R;b.push([w,R])}else p&&(i(O,k),s(R)||(O[w]=R))}var E,P;if(d&&(E=d.fieldDefs,P=d.keyList),E)for(var w in E.fields)if(E.fields.hasOwnProperty(w)){var _=E.fields[w],j=u(n,w,_,r,t),R=j.result,k=j.keysToDel;if(f(R)){if(h)return R;b.push([w,R])}else p&&(i(O,k),s(R)||(O[w]=R))}if(p&&b.length>0){for(var A={},C=[],z=0;z<b.length;z++){var M=b[z],D=M[0],F=M[1];C.push(D),A[D]=F}var N=new l(n,e,A,"Some properties failed validation: "+C.join(", "));return N}return O}throw"no impl"}var a,p=e.exprs[0].propArgs,v=p.req,d=p.opt;return{trailblaze:n,reconstruct:t}}function o(e,r,n,t){return function(r){if(e){var o,i,u=[],s=e.fieldDefs,c=e.keyList;if(s){i=[];for(var p in s.fields)s.fields.hasOwnProperty(p)&&i.push(p)}else{if(!c)throw"unsupported";i=[].concat(c)}for(var v=0;v<i.length;v++){var p=i[v];if(o=void 0,s&&s.fields[p].keyValExprPair){o=!1;for(var d in r)if(r.hasOwnProperty(d)){var m=a(d,s.fields[p].keyValExprPair.keySpec,n,t);if(!f(m)){o=!0;break}}}else c&&void 0===r[p]&&u.push(p)}if(u.length>0||o===!1)return new l(r,e,[],"req: keys required: "+u.join(", "))}return r}}function i(e,r){for(var n=0;n<r.length;n++)delete e[[r[n]]]}function u(e,r,n,t,o){var i,u=n.valSpecAltsOnly,c=n.keyValExprPair;if(c){var l=[],p=c.keySpec,v=c.valSpec;i=void 0;for(var d in e){var m=a(d,p,t,o);if(e!==e[m]&&!f(m)){var h=a(e[m],v,t,o);if(f(h))return{problem:h};l.push(m)}}return{matchedKeys:l}}if(u){var v=u,i=e[r];return!s(i)&&e[r]!==e&&(i=a(i,v,t,o),f(i))?i:{key:r}}}function a(e,r,n,t){if(r.spec){var o=r.spec;return n(o,e,t)}if(r.pred){var i=p(r.pred);return n(i,e,t)}throw console.error(r),"no impl"}var f=n(2),s=n(9),c=n(4),l=n(0),p=n(6);e.exports=t},function(e,r){function n(e,r){return{trailblaze:walkSpecRef,reconstruct:walkSpecRef}}e.exports=n},function(e,r,n){var t,o,i;!function(n,u){"use strict";"object"==typeof e&&"object"==typeof e.exports?e.exports=u():(o=[],t=u,i="function"==typeof t?t.apply(r,o):t,!(void 0!==i&&(e.exports=i)))}(this,function(){"use strict";function e(e,r){return null!=e&&Object.prototype.hasOwnProperty.call(e,r)}function r(r){if(!r)return!0;if(f(r)&&0===r.length)return!0;if("string"!=typeof r){for(var n in r)if(e(r,n))return!1;return!0}return!1}function n(e){return a.call(e)}function t(e){return"object"==typeof e&&"[object Object]"===n(e)}function o(e){return"boolean"==typeof e||"[object Boolean]"===n(e)}function i(e){var r=parseInt(e);return r.toString()===e?r:e}function u(n){function u(r,t){if(n.includeInheritedProps||"number"==typeof t&&Array.isArray(r)||e(r,t))return r[t]}function a(e,r,n,t){if("number"==typeof r&&(r=[r]),!r||0===r.length)return e;if("string"==typeof r)return a(e,r.split(".").map(i),n,t);var o=r[0],f=u(e,o);return 1===r.length?(void 0!==f&&t||(e[o]=n),f):(void 0===f&&("number"==typeof r[1]?e[o]=[]:e[o]={}),a(e[o],r.slice(1),n,t))}n=n||{};var s=function(e){return Object.keys(s).reduce(function(r,n){return"create"===n?r:("function"==typeof s[n]&&(r[n]=s[n].bind(s,e)),r)},{})};return s.has=function(r,t){if("number"==typeof t?t=[t]:"string"==typeof t&&(t=t.split(".")),!t||0===t.length)return!!r;for(var o=0;o<t.length;o++){var u=i(t[o]);if(!("number"==typeof u&&f(r)&&u<r.length||(n.includeInheritedProps?u in Object(r):e(r,u))))return!1;r=r[u]}return!0},s.ensureExists=function(e,r,n){return a(e,r,n,!0)},s.set=function(e,r,n,t){return a(e,r,n,t)},s.insert=function(e,r,n,t){var o=s.get(e,r);t=~~t,f(o)||(o=[],s.set(e,r,o)),o.splice(t,0,n)},s.empty=function(n,i){if(!r(i)&&null!=n){var u,a;if(u=s.get(n,i)){if("string"==typeof u)return s.set(n,i,"");if(o(u))return s.set(n,i,!1);if("number"==typeof u)return s.set(n,i,0);if(f(u))u.length=0;else{if(!t(u))return s.set(n,i,null);for(a in u)e(u,a)&&delete u[a]}}}},s.push=function(e,r){var n=s.get(e,r);f(n)||(n=[],s.set(e,r,n)),n.push.apply(n,Array.prototype.slice.call(arguments,2))},s.coalesce=function(e,r,n){for(var t,o=0,i=r.length;o<i;o++)if(void 0!==(t=s.get(e,r[o])))return t;return n},s.get=function(e,r,n){if("number"==typeof r&&(r=[r]),!r||0===r.length)return e;if(null==e)return n;if("string"==typeof r)return s.get(e,r.split("."),n);var t=i(r[0]),o=u(e,t);return void 0===o?n:1===r.length?o:s.get(e[t],r.slice(1),n)},s.del=function(e,n){if("number"==typeof n&&(n=[n]),null==e)return e;if(r(n))return e;if("string"==typeof n)return s.del(e,n.split("."));var t=i(n[0]),o=u(e,t);if(null==o)return o;if(1===n.length)f(e)?e.splice(t,1):delete e[t];else if(void 0!==e[t])return s.del(e[t],n.slice(1));return e},s}var a=Object.prototype.toString,f=Array.isArray||function(e){return"[object Array]"===a.call(e)},s=u();return s.create=u,s.withInheritedProps=u({includeInheritedProps:!0}),s})},function(e,r){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,r,n){var t=n(4),o=n(29),i=n(14),u=n(30),a=n(15),f={Problem:n(0),Spec:n(1)},s=t(o,i,u,f,a);e.exports=s}])});